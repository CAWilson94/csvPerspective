var Ao=Object.defineProperty;var et=(e,t)=>{for(var r in t)Ao(e,r,{get:t[r],enumerable:!0})};Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(t!==null&&t.nodeType===1);return null});import*as Jr from"d3fc";import*as me from"d3fc";var C={none:"none",ordinal:"ordinal",time:"time",linear:"linear"},Me=e=>{let t="crossValues",r=null,o=null,n=()=>{let a=l=>{let i=r?e[t].filter(c=>r==c.name):e[t];return t=="crossValues"&&i.length>1?!1:i.some(c=>l.includes(c.type))};return e[t].length===0?C.none:o!=C.time&&a(["datetime","date"])?C.time:o!=C.linear&&a(["integer","float"])||o==C.ordinal?C.linear:C.ordinal};return n.settingName=(...a)=>a.length?(t=a[0],n):t,n.settingValue=(...a)=>a.length?(r=a[0],n):r,n.excludeType=(...a)=>a.length?(o=a[0],n):o,n};var Ft={};et(Ft,{domain:()=>Eo,labelFunction:()=>Pt,scale:()=>zo});import*as fr from"d3";var pr=e=>{let t=r=>(o,n)=>o===void 0?n:n===void 0?o:r(o,n);return e.reduce((r,o)=>[t(Math.min)(r[0],o[0]),t(Math.max)(r[1],o[1])],[void 0,void 0])},ie=e=>Array.isArray(e)?e.flat(1/0):[e];import{rebindAll as ko}from"d3fc";var To=1,tt=e=>{let t=r=>e(r);return ko(t,e),t.bandwidth=(...r)=>r.length?(e.bandwidth(...r),t):Math.max(e.bandwidth(),To),t};import{rebindAll as Lo}from"d3fc";var dr=e=>{let t=r=>e(r);return Lo(t,e),t.ticks=function(){return[]},t};var zo=()=>dr(tt(fr.scaleBand())),Eo=()=>{let e=["crossValue"],t="horizontal",r=n=>{let a=ie(n);return o([...new Set(a.map(l=>l[e[0]]))])},o=n=>t=="vertical"?n.reverse():n;return r.valueName=(...n)=>n.length?(e=[n[0]],r):e[0],r.valueNames=(...n)=>n.length?(e=n[0],r):e,r.orient=(...n)=>n.length?(t=n[0],r):t,r},Pt=e=>t=>t[e].join("|");var $t={};et($t,{component:()=>Do,domain:()=>Bt,labelFunction:()=>It,scale:()=>No,tickFormatFunction:()=>Oo});import*as We from"d3";import*as X from"d3fc";import*as se from"d3-array";var rt=()=>{let e=[0,0],t="percent",r=o=>{switch(t){case"domain":{o[0]-=e[0],o[1]+=e[1];break}case"percent":{let n=o[1]-o[0];o[0]-=e[0]*n,o[1]+=e[1]*n;break}default:throw new Error("Unknown padUnit: "+t)}return o};return r.pad=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],r):e},r.padUnit=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],r):t},r};var hr=function(){let e=[function(a){return a}],t=null,r=[],o=rt(),n=function(l){let i=new Array(l.length),c=!0,s=!1,m,d=e[Symbol.iterator]();try{for(let p;!(c=(p=d.next()).done);c=!0){let f=p.value;for(let h=0;h<l.length;h++){let g=f(l[h],h);Array.isArray(g)?i.push.apply(i,Rt(g)):i.push(g)}}}catch(p){s=!0,m=p}finally{try{!c&&d.return&&d.return()}finally{if(s)throw m}}let u=[se.min(i),se.max(i)];if(u[0]=u[0]==null?se.min(r):se.min([u[0]].concat(Rt(r))),u[1]=u[1]==null?se.max(r):se.max([u[1]].concat(Rt(r))),t!=null){let p=Math.max(Math.abs(u[1]-t),Math.abs(u[0]-t));u[0]=t-p,u[1]=t+p}return o(u)};return n.accessors=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],n):e},n.pad=function(){return arguments.length?(o.pad(arguments.length<=0?void 0:arguments[0]),n):o.pad},n.padUnit=function(){return arguments.length?(o.padUnit(arguments.length<=0?void 0:arguments[0]),n):o.padUnit},n.include=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],n):r},n.symmetricalAbout=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n.paddingStrategy=function(){return arguments.length?(o=arguments.length<=0?void 0:arguments[0],n):o},n},Rt=function(e){if(Array.isArray(e)){let t=Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}else return Array.from(e)};import*as nt from"d3";var Mo=1e7,ot=e=>Math.abs(e)>=Mo?nt.format(".3s")(e):Number.isInteger(e)?nt.format(",.0f")(e):nt.format(",.2f")(e);function Ne(e){return e.getRootNode().host}function ce(e){return e.closest("#container.chart")}var No=()=>We.scaleLinear(),Bt=()=>{let e=hr().pad([0,.1]).padUnit("percent"),t=["crossValue"],r=a=>(e.accessors(t.map(l=>i=>parseFloat(i[l]))),n(ie(a)));X.rebindAll(r,e);let o=a=>{let l=t.map(i=>a.map(c=>c[i]).sort((c,s)=>c-s).filter((c,s,m)=>s===0||c!==m[s-1]).reduce((c,s,m,d)=>m===0||c<=s-d[m-1]?c:Math.abs(s-d[m-1])));return Math.min(...l)},n=a=>{if(e.padUnit()=="domain"){let l=o(a);return e.pad([l/2,l/2])(a)}else return e(a)};return r.valueName=(...a)=>a.length?(t=[a[0]],r):t[0],r.valueNames=(...a)=>a.length?(t=a[0],r):t,r},It=e=>t=>t[e][0],Oo=ot,Do=e=>{let t=null,r="horizontal",o=null,n=(s,m)=>{try{return ce(s.node()).querySelector(".cartesian-chart").querySelector(`.${m}-axis`)}catch{return null}},a=s=>{let m=We.select(s).select("text").node();m.style.fontSize="80%"},l=(s,m)=>{let d=s.getBoundingClientRect();m.each((u,p,f)=>{let h=We.select(f[p]).node().getBoundingClientRect();(r=="vertical"&&d.width<h.width||r=="horizontal"&&d.height<h.height)&&a(f[p])})},i=(s,m,d)=>{let u=n(s,m);u&&l(u,s)},c=()=>({bottom:X.axisBottom,left:X.axisLeft,top:X.axisTop,right:X.axisRight,decorate:i});return c.domain=(...s)=>s.length?(t=s[0],c):t,c.orient=(...s)=>s.length?(r=s[0],c):r,c.settingName=(...s)=>s.length?(o=s[0],c):o,c};var Gt={};et(Gt,{domain:()=>Fo,labelFunction:()=>Ht,scale:()=>Po});import*as gr from"d3";import*as Oe from"d3fc";var Po=()=>gr.scaleTime(),Fo=()=>{let e=Oe.extentTime(),t=["crossValue"],r=a=>(e.accessors(t.map(l=>i=>new Date(i[l]))),n(ie(a)));Oe.rebindAll(r,e,Oe.exclude("include","paddingStrategy"));let o=a=>{let l=t.map(i=>a.map(c=>new Date(c[i]).getTime()).sort((c,s)=>c-s).filter((c,s,m)=>s===0||c!==m[s-1]).reduce((c,s,m,d)=>m===0||Math.abs(c)<=Math.abs(s-d[m-1])?Math.abs(c):Math.abs(s-d[m-1])));return Math.min(...l)},n=a=>{let l=Math.abs(o(a));return e.padUnit("domain").pad([l/2,l/2])(a)};return r.valueName=(...a)=>a.length?(t=[a[0]],r):t[0],r.valueNames=(...a)=>a.length?(t=a[0],r):t,r},Ht=e=>t=>new Date(t[e][0]);var Wt={};et(Wt,{component:()=>Yo,domain:()=>Wo,labelFunction:()=>jt,scale:()=>jo});import*as Ye from"d3";import*as ue from"d3fc";import{select as xr,line as Ro}from"d3";import{axisOrdinalTop as Bo,axisOrdinalBottom as Io,axisOrdinalLeft as $o,axisOrdinalRight as Ho,dataJoin as br,rebindAll as vr,exclude as Go}from"d3fc";var yr=(...e)=>{let t={},r=o=>{for(let n of Object.keys(t))o[n](t[n]);return o};for(let o of e)r[o]=(...n)=>n.length?(t[o]=n[0],r):t[o];return r};var at=(e,t,r)=>{let o=6,n=6,a=yr("tickFormat","ticks","tickArguments","tickValues","tickPadding"),l=()=>{},i=null,c=br("g","group"),s=br("path","domain"),m=(h,g)=>u()?`translate(${g}, ${h})`:`translate(${h}, ${g})`,d=h=>u()?h.map(g=>[g[1],g[0]]):h,u=()=>e==="left"||e==="right",p=h=>{if(!i){a(t(r).decorate(l))(h);return}h.each((g,y,x)=>{let v=x[y],b=xr(v),w=e==="bottom"||e==="right"?1:-1,V=r.range(),k=d([[V[0],w*o],[V[0],0],[V[1],0],[V[1],w*o]]);s(b,[g]).attr("d",Ro()(k)).attr("stroke","#000").attr("fill","none");let j=c(b,i),M=I=>Array.isArray(n)?n[I]:n,z=I=>{let E=0;for(let S=0;S<I;S++)E+=M(S);return E};j.attr("transform",(I,E)=>m(0,w*z(E))).each((I,E,S)=>{let T=xr(S[E]),$=f(r,I);a(t($)).decorate((te,le)=>l(te,le,E)).tickSizeInner(M(E)).tickOffset(te=>$.step(te)/2)(T),T.select("path.domain").attr("visibility","hidden")}),j.exit().attr("transform",(I,E)=>m(0,w*z(E)))})},f=(h,g)=>{function y(x){let v=x.domain;return v.reduce((b,w)=>b+h(w),0)/v.length}return y.ticks=()=>g,y.tickFormat=()=>x=>x.text,y.copy=()=>f(h,g),y.step=x=>x.domain.length*h.step(),vr(y,h,Go("ticks","step","copy")),y};return p.tickSize=(...h)=>h.length?(n=o=Number(h[0]),p):n,p.tickSizeInner=(...h)=>h.length?(n=Array.isArray(h[0])?h[0]:Number(h[0]),p):n,p.tickSizeOuter=(...h)=>h.length?(o=Number(h[0]),p):o,p.decorate=(...h)=>h.length?(l=h[0],p):l,p.groups=(...h)=>h.length?(i=h[0],p):i,vr(p,a),p},wr=e=>at("top",Bo,e),_r=e=>at("bottom",Io,e),Vr=e=>at("left",$o,e),Sr=e=>at("right",Ho,e);var jo=()=>tt(Ye.scaleBand()).padding(.5),Wo=()=>{let e=["crossValue"],t="horizontal",r=n=>{let a=ie(n);return o([...Array.from(new Set(a.map(l=>l[e[0]])))])},o=n=>t=="vertical"?n.reverse():n;return r.valueName=(...n)=>n.length?(e=[n[0]],r):e[0],r.valueNames=(...n)=>n.length?(e=n[0],r):e,r.orient=(...n)=>n.length?(t=n[0],r):t,r},jt=e=>t=>t[e].join("|"),Yo=e=>{let t="horizontal",r="crossValues",o=null,n=()=>{let u=e[r].length>1,p=l(o),f=p.map(i),h=u?f.map(b=>b.size):f[0].size,g=f.reduce((b,w)=>b+w.size,0),y=b=>w=>{let V=b(w);return u&&V.groups(p).tickSizeInner(h).tickSizeOuter(g),t!=="horizontal"&&V.tickPadding(10),V},x=(b,w,V)=>{let k=f[V].rotation;t==="horizontal"&&d(b,k),c(b,k)},v=a(u);return{bottom:y(v.bottom),left:y(v.left),right:y(v.right),top:y(v.top),size:`${g+10}px`,decorate:x}},a=u=>u?{bottom:_r,left:Vr,top:wr,right:Sr}:{bottom:ue.axisOrdinalBottom,left:ue.axisOrdinalLeft,top:ue.axisOrdinalTop,right:ue.axisOrdinalRight},l=u=>{let p=[];return u.forEach(f=>{(f&&f.split?f.split("|"):[f]).forEach((g,y)=>{for(;p.length<=y;)p.push([]);let x=p[y];x.length>0&&x[x.length-1].text===g?x[x.length-1].domain.push(f):x.push({text:g,domain:[f]})})}),p.reverse()},i=u=>{let p=e.size.width,f=Math.max(...u.map(h=>h.text?h.text.length:0));return t==="horizontal"?u&&u.length*16>p-100?{size:f*5+10,rotation:90}:u&&u.length*(f*6+10)>p-100?{size:f*3+20,rotation:45}:{size:25,rotation:0}:{size:f*5+10,rotation:0}},c=(u,p)=>{let f=w=>{let V=w.indexOf(",")!==-1?",":" ",k=w.substring(w.indexOf("(")+1,w.indexOf(")")).split(V).map(B=>parseInt(B));for(;k.length<2;)k.push(0);return k},y=p?(w,V)=>w.x+w.width+14>V.x+V.width:(w,V)=>w.x<=V.x+V.width&&V.x<=w.x+w.width&&w.y<=V.y+V.height&&V.y<=w.y+w.height,x=(w,V)=>w.x>=V.x&&w.x+w.width<=V.x+V.width&&w.y>=V.y&&w.y+w.height<=V.y+V.height,v=t=="horizontal"?s(u):null,b=[];u.each((w,V,k)=>{let B=Ye.select(k[V]),j=f(B.attr("transform")),M=B.node().getBBox(),z={x:M.x+j[0],y:M.y+j[1],width:M.width,height:M.height},E=b.some(S=>y(S,z))||v&&!x(z,v);B.attr("visibility",E?"hidden":""),E||b.push(z)})},s=u=>{let p=ce(u.node());if(p===null)return;let f=p.querySelector(".cartesian-chart"),h=f.querySelector(".x-axis"),g=f.getBoundingClientRect(),y=h.getBoundingClientRect();return{x:g.left-y.left,width:g.width,y:g.top-y.top,height:g.height}},m=u=>u?u<60?`rotate(-${u} 5 5)`:`rotate(-${u} 3 7)`:"translate(0, 8)",d=(u,p)=>{let f=m(p),h=p?"end":"";u.each((g,y,x)=>{Ye.select(x[y]).select("text").attr("transform",f).style("text-anchor",h)})};return n.orient=(...u)=>u.length?(t=u[0],n):t,n.settingName=(...u)=>u.length?(r=u[0],n):r,n.domain=(...u)=>u.length?(o=u[0],n):o,n};var Uo={none:Ft,ordinal:Wt,time:Gt,linear:$t},A=e=>{let t=null,r="horizontal",o="crossValues",n=null,a=["crossValue"],l=null,i=null,c=["include","paddingStrategy","pad"],s={},m=p=>{let f=Me(e).excludeType(t).settingName(o).settingValue(n)(),h=Uo[f],g=h.domain().valueNames(a);c.forEach(v=>{s[v]&&g[v]&&g[v](s[v])}),g.orient&&g.orient(r);let y=g(p);l!==null&&(y=l(y)),i&&typeof y[0]=="number"&&(i[0]=y[0]=Math.min(y[0],i[0]),i[1]=y[1]=Math.max(y[1],i[1]));let x=h.component?d(h,y,p):u();return{scale:h.scale(),domain:y,domainFunction:g,labelFunction:h.labelFunction,component:{bottom:x.bottom,left:x.left,top:x.top,right:x.right},size:x.size,decorate:x.decorate,label:e[o].map(v=>v.name).join(", "),tickFormatFunction:h.tickFormatFunction}},d=(p,f,h)=>p.component(e).orient(r).settingName(o).domain(f)(h),u=()=>({bottom:me.axisBottom,left:me.axisLeft,top:me.axisTop,right:me.axisRight,decorate:()=>{}});return m.memoValue=(...p)=>p.length?(i=p[0],m):i,m.excludeType=(...p)=>p.length?(t=p[0],m):t,m.orient=(...p)=>p.length?(r=p[0],m):r,m.settingName=(...p)=>p.length?(o=p[0],m):o,m.settingValue=(...p)=>p.length?(n=p[0],m):n,m.valueName=(...p)=>p.length?(a=[p[0]],m):a[0],m.valueNames=(...p)=>p.length?(a=p[0],m):a,m.modifyDomain=(...p)=>p.length?(l=p[0],m):l,c.forEach(p=>{m[p]=(...f)=>f.length?(s[p]=f[0],m):s[p]}),m};import*as pe from"d3";import*as Ve from"d3fc";var Y=(e,t)=>Cr(e,t,(r,o)=>r.svgPlotArea(o),!1),De=(e,t)=>Cr(e,t,(r,o)=>r.canvasPlotArea(o).svgPlotArea(Ve.seriesSvgPoint()),!0),Cr=(e,t,r,o)=>{let n=null,a=null,l=Ve.chartCartesian({xScale:e.scale,yScale:t.scale,xAxis:e.component,yAxis:t.component}).xDomain(e.domain).xLabel(e.label).xAxisHeight(e.size).xDecorate(e.decorate).xTickFormat(e.tickFormatFunction).yDomain(t.domain).yLabel(t.label).yAxisWidth(t.size).yDecorate(t.decorate).yOrient("left").yTickFormat(t.tickFormatFunction);e.decorate&&l.xDecorate(e.decorate),t.decorate&&l.yDecorate(t.decorate),l.xPaddingInner&&l.xPaddingInner(1),l.xPaddingOuter&&l.xPaddingOuter(.5),l.yPaddingInner&&l.yPaddingInner(1),l.yPaddingOuter&&l.yPaddingOuter(.5),l.axisSplitter=(...c)=>c.length?(n=c[0],l):n,l.altAxis=(...c)=>c.length?(a=c[0],l):a,l.plotArea=function(...c){return c.length==0?o?this.canvasPlotArea():this.svgPlotArea():r(this,...c)};let i=l.decorate();return l.decorate((c,s)=>{let m=c.select("d3fc-svg.plot-area"),d=m.select("svg").node();d.setAttribute("viewBox",`0 0 ${m.node().clientWidth} ${m.node().clientHeight}`),d.setAttribute("preserveAspectRatio","none");for(let u of["x-axis","y-axis"])c.select(`d3fc-svg.${u} svg`).node().setAttribute("preserveAspectRatio","none");if(i(c,s),o){let u=c.select(".svg-plot-area").node(),p=c.select(".canvas-plot-area").node();pe.selectAll([u,p]).order()}if(!!n){if(n.haveSplit()){let u=n.altData(),p=Ve.dataJoin("d3fc-svg","y2-axis").key(y=>y),f=Ve.dataJoin("g","y-series").key(y=>y);c.append("div").attr("class","y-label right-label").style("grid-column",5).style("-ms-grid-column",5).style("grid-row",3).style("-ms-grid-row",3).style("width",a.size||"1em").style("display","flex").style("align-items","center").style("justify-content","center").append("span").attr("class","y-label splitter-label").style("transform","rotate(-90deg)");let h=a.scale.domain(a.domain),g=a.component.right(h);if(g.tickFormat(a.tickFormatFunction),a.decorate&&g.decorate(a.decorate),p(c,["right"]).attr("class",y=>`y-axis ${y}-axis`).on("measure",function(y,x){let{width:v,height:b}=y.detail;x==="left"&&pe.select(y.currentTarget).select("svg").attr("viewBox",`${-v} 0 ${v} ${b}`).attr("preserveAspectRatio","none"),h.range([b,0])}).on("draw",function(y,x){pe.select(y.currentTarget).select("svg").call(g)}),o){let y=x=>{let v=l.plotArea();v.context(x.node().getContext("2d")).xScale(e.scale);let b=[t.scale,h];[s,u].forEach((w,V)=>{v.yScale(b[V]),v(w)})};c.select("d3fc-canvas.plot-area").on("draw",function(x,v){y(pe.select(x.currentTarget).select("canvas"))})}else{let y=function(x){let v=l.plotArea();v.xScale(e.scale);let b=[t.scale,h];f(x,[s,u]).each((w,V,k)=>{v.yScale(b[V]),pe.select(k[V]).datum(w).call(v)})};c.select("d3fc-svg.plot-area").on("draw",function(x,v){y(pe.select(x.currentTarget).select("svg"))})}}n(c)}}),l};import*as oe from"d3fc";import{select as Xt}from"d3";function N(e,t,r){let o=e.select(t);return o.size()>0?o:r()}function q(e,t,r="right"){if(r==="right"||r==="bottom")return e[r]<t[r];if(r==="left"||r==="top")return e[r]>t[r];throw`Direction being checked for overflow is invalid: ${r}`}function Yt(e,t,r,o=0){let n=e==="x"?"width":"height",a=t[e],l=t[e]+t[n],i=r[e],c=r[e]+r[n],s=i+o>a&&i-o<l,m=c+o>a&&c-o<l,d=i+o<a&&c-o>l;return s||m||d}var Ar=`<ul id="tooltip-values"></ul>
`;import{select as Xo}from"d3";var kr={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}};function Pe(e){let t={};if(Tr().types[e]&&Object.assign(t,Tr().types[e]),t.type){let r=Pe(t.type);return Object.assign(r,t),r}else return t}function Ut(e){return e&&typeof e=="object"&&!Array.isArray(e)}function Kt(e,...t){if(!t.length)return e;let r=t.shift();if(Ut(e)&&Ut(r))for(let o in r)Ut(r[o])?(e[o]||Object.assign(e,{[o]:{}}),Kt(e[o],r[o])):Object.assign(e,{[o]:r[o]});return Kt(e,...t)}function Tr(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=Kt(kr,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}function ne(e,t){switch(e){case"date":case"datetime":return t instanceof Date?t:new Date(parseInt(t)).toLocaleString([],Pe(e).format);case"integer":return parseInt(t,10);case"float":return parseFloat(t)}return t}function lt(e,t){return t.crossValues.length===0?[]:e.crossValue.length===0?[]:((e.crossValue.split?e.crossValue.split("|"):[e.crossValue])||[e.key]).map((o,n)=>({name:t.crossValues[n].name,value:ne(t.crossValues[n].type,o)}))}function it(e,t){if(t.splitValues.length===0)return[];let r=[e.mainValue];return e.key?r=e.key.split("|"):e.mainValue?.split&&(r=e.mainValue.split("|")),t.splitValues.map((o,n)=>({name:o.name,value:ne(o.type,r[n])}))}function st(e,t){return t.mainValues.length>1?e.mainValues?t.mainValues.map((r,o)=>({name:r.name,value:ne(r.type,e.mainValues[o])})):t.mainValues.map(r=>({name:r.name,value:ne(r.type,e.row[r.name])})):[{name:t.mainValues[0].name,value:ne(t.mainValues[0].type,e.colorValue||e.mainValue-e.baseValue||e.mainValue||e.mainValues)}]}function Lr(e,t,r){let o=lt(t,r).concat(it(t,r)).concat(st(t,r));qo(e,o)}function qo(e,t){e.select("#tooltip-values").selectAll("li").data(t).join("li").each(function(r){Xo(this).text(`${r.name}: `).append("b").text(Zo(r.value))})}var Zo=e=>e==null?"-":e.toLocaleString(void 0,{style:"decimal",minimumFractionDigits:Pe("float").precision,maximumFractionDigits:Pe("float").precision});var zr=e=>[e.name,"==",e.value],Ue=(e,t,r)=>{let o=st(t,r).map(i=>i.name),n=lt(t,r).map(zr),a=it(t,r).map(zr),l=r.filter.concat(n).concat(a);e.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{column_names:o,config:{filter:l},row:t.row}}))},Er=()=>{let e=null,t=r=>{let o=r.node();r.on("click",(n,a)=>Ue(o,a,e))};return t.settings=(...r)=>r.length?(e=r[0],t):e,t};var de=()=>{let e=!1,t=null,r=null,o=!1,n=a=>{let l=a.node();if(!l||!l.isConnected){Mr(t);return}let i=Xt(ce(l));t=Jo(i);let c=function(m,d){Lr(t,d,r);let u=a.nodes(),p=u.indexOf(this);Qo(i.node(),u[p],t,o),Xt(u[p]).style("opacity","0.7")},s=function(m,d){Mr(t);let u=a.nodes(),p=u.indexOf(this);u&&Xt(u[p]).style("opacity","1")};e?a.each(function(m){return c.call(this,void 0,m)}):(a.on("mouseover",c).on("mouseout",s),Er().settings(r)(a))};return n.alwaysShow=(...a)=>a.length?(e=a[0],n):e,n.centered=(...a)=>a.length?(o=a[0],n):o,n.settings=(...a)=>a.length?(r=a[0],n):r,n};function Jo(e){return N(e,"div.tooltip",()=>e.append("div").attr("class","tooltip").style("z-index",3).style("opacity",0).html(Ar))}function Qo(e,t,r,o){let n=e.getBoundingClientRect(),a=t.getBoundingClientRect(),l=a.left+a.width/2-n.left,i=a.top-n.top+e.scrollTop;o&&(i=a.top+a.height/2-n.top+e.scrollTop),r.style("left",`${l}px`).style("top",`${i}px`).style("opacity",.9),o&&([l,i]=ea(r,n)),ta(r,n,l,i,o)}function ea(e,t){let r=e.node().getBoundingClientRect(),o=r.width/2,n=r.left-o-t.left;e.style("left",`${n}px`);let a=r.height/2,l=r.top-a-t.top;return e.style("top",`${l}px`),[n,l]}function ta(e,t,r,o,n=!1){let a=e.node().getBoundingClientRect();if(q(t,a)){let l=a.right-t.right;e.style("left",`${r-l}px`)}if(q(t,a,"bottom")){let l=a.bottom-t.bottom;e.style("top",`${o-l}px`)}if(!!n){if(q(t,a,"left")){let l=a.left-t.left;e.style("left",`${r-l}px`)}if(q(t,a,"top")){let l=a.top-t.top;e.style("top",`${o-l}px`)}}}function Mr(e){e&&e.style("opacity",0)}function ct(e,t){let r=e.mainValues.length>1?oe.seriesSvgGrouped(oe.seriesSvgBar()):oe.seriesSvgBar();return r=r.decorate(o=>{de().settings(e)(o),o.style("fill",n=>t(n.key))}),oe.autoBandwidth(ra(r)).crossValue(o=>o.crossValue).mainValue(o=>o.mainValue?o.mainValue:0).baseValue(o=>o.baseValue)}var ra=e=>{let t=r=>e(r);return oe.rebindAll(t,e),t.bandwidth=(...r)=>r.length?(e.bandwidth(Math.max(r[0],1)),t):e.bandwidth(),t};import*as ut from"d3";function fe(e){return e.split("|").slice(0,-1).join("|")}function Z(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=Object.keys(t).filter(o=>o!=="__ROW_PATH__");return he().settings(e).domain(r)()}function mt(e,t){let r=Array.from(new Set(t));return he().settings(e).domain(r)()}function pt(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=[];return Object.keys(t).forEach(o=>{if(o!=="__ROW_PATH__"){let n=fe(o);r.includes(n)||r.push(n)}}),he().settings(e).domain(r)()}function he(){let e=null,t=null,r={},o=a=>Se(a,r.colorStyles&&r.colorStyles.opacity),n=()=>{let a=r.colorStyles,l=t||[a.series];if(l||e.length>1){let i=e.length>1?a.scheme:l;return ut.scaleOrdinal(i.map(o)).domain(e)}return null};return n.domain=(...a)=>a.length?(e=a[0],n):e,n.defaultColors=(...a)=>a.length?(t=a[0],n):t,n.mapFunction=(...a)=>a.length?(o=a[0],n):o,n.settings=(...a)=>a.length?(r=a[0],n):r,n}function J(e){return Ce(1)(e)}function Se(e,t=.5){return Ce(t)(e)}function Ce(e){return t=>{let r=ut.color(t);return r.opacity=e,r+""}}import{rebindAll as na}from"d3fc";var oa={none:Pt,ordinal:jt,time:Ht,linear:It},U=e=>{let t=Me(e),r="__ROW_PATH__",o=(n,a)=>oa[t()](r)(n,a);return na(o,t),o.valueName=(...n)=>n.length?(r=n[0],o):r,o};function Ae(e,t,{stack:r=!1,excludeEmpty:o=!1}={}){let n=t||e.data;return e.splitValues.length>0?aa(e,n,{stack:r,excludeEmpty:o}):[n]}function aa(e,t,{stack:r=!1,excludeEmpty:o=!1}){let n={};return t.forEach(a=>{let l={},i={};Object.keys(a).filter(c=>c!=="__ROW_PATH__").filter(c=>!o||a[c]!=null&&a[c]!=null).forEach(c=>{let s=c.split("|"),m=s[s.length-1],d=a[c]||0,u=`${m}${d>=0?"+ve":"-ve"}`,p=s.slice(0,s.length-1).join("|"),f=i[p]=i[p]||{__ROW_PATH__:a.__ROW_PATH__},h=l[u]||0;f.__KEY__=p,r?(f[m]=h+d,f[`__BASE_VALUE__${m}`]=h,l[u]=f[m]):f[m]=d,f.row=a}),Object.keys(i).forEach(c=>{(n[c]=n[c]||[]).push(i[c])})}),Object.keys(n).map(a=>{let l=n[a];return l.key=a,l})}function Nr(e,t){let r={stack:!1},o=Ae(e,t,r).map(n=>Or(e,n,r));return e.mainValues.length>1?o.reduce((a,l)=>a.concat(l)):o}function dt(e,t){let r={stack:!0};return Ae(e,t,r).map(o=>Or(e,o,r))}function la(e,t,{stack:r=!1}){let o=U(e);return n=>{let a=i=>r&&i[`__BASE_VALUE__${n.name}`]||0,l=t.map((i,c)=>({crossValue:o(i,c),mainValue:i[n.name]?i[n.name]:null,baseValue:a(i),key:i.__KEY__?`${i.__KEY__}|${n.name}`:n.name,row:i.row||i}));return l.key=l[0].key,l}}function Or(e,t,{stack:r=!1}){let o=la(e,t,{stack:r});return e.mainValues.length>1?e.mainValues.map(o):o(e.mainValues[0])}import*as ft from"d3";import*as ht from"d3-svg-legend";import*as Yr from"d3-svg-legend";import{rebindAll as ya}from"d3fc";var Dr=`<span id="up-arrow">&#9650;</span>
<span id="page-text"></span>
<span id="down-arrow">&#9660;</span>
`;function Pr(e){let t=e.select("g.legendCells"),r=e.node().getBoundingClientRect();if(!q(r,t.node().getBoundingClientRect()))return;let o=e.select(".legend");t.selectAll(".label").text((n,a,l)=>{let i=l[a];if(q(r,i.getBoundingClientRect())){let c=sa(i,o,r);return`${n.substring(0,c-3)}...`}else return n})}function sa(e,t,r){let o=e.getBoundingClientRect(),n=t.node().createSVGPoint(),a=3;return n.x=r.right-o.left-a,n.y=0,e.getCharNumAtPosition(n)}import*as Te from"d3";import*as Fr from"d3";var ke=10;function ge(e,t,r){let o=Fr.select(Ne(e).getContainer()).node().getBoundingClientRect(),n=e.getBoundingClientRect(),a={top:n.top+r-ke,right:n.right+t+ke,bottom:n.bottom+r+ke,left:n.left+t-ke},l={x:t,y:r};return[{edge:"right",dimension:"x"},{edge:"left",dimension:"x"},{edge:"top",dimension:"y"},{edge:"bottom",dimension:"y"}].forEach(c=>{if(q(o,a,c.edge)){let s=a[c.edge]-o[c.edge];l[c.dimension]=l[c.dimension]-s}}),l}var qt="resize.for-dragging";function Rr(){let e=!0,t=null,r=o=>{let n=o.node(),a=n.getRootNode().host.closest("perspective-viewer");n.style.cursor="move",t.legend&&(n.style.left=t.legend.left,n.style.top=t.legend.top);let l=Te.drag().on("drag",function(i){let c=ge(this,i.dx,i.dy);this.style.left=`${this.offsetLeft+c.x}px`,this.style.top=`${this.offsetTop+c.y}px`;let s={left:this.style.left,top:this.style.top};t.legend={...t.legend,...s},e=ma(n)?ua(n):ca(n,e)});l.on("end",function(i){Te.select(window).on(qt,null),a?.dispatchEvent(new Event("perspective-config-update"))}),o.call(l)};return r.settings=(...o)=>o.length?(t=o[0],r):t,r}function ca(e,t){return t!==!1&&Te.select(window).on(qt,function(){let r=ge(e,0,0);e.style.left=`${e.offsetLeft+r.x}px`,e.style.top=`${e.offsetTop+r.y}px`}),!1}function ua(e){return Te.select(window).on(qt,null),e.style.left="auto",!0}function ma(e){let t=e.getBoundingClientRect(),r=Te.select(ce(e)).node().getBoundingClientRect(),o=5;return t.right+ke+o>=r.right&&t.top-ke-o<=r.top}import*as Ke from"d3";var Br="horizontal-drag-handle",Ir="vertical-drag-handle",pa="corner-drag-handle",Hr="dragHandles",$r=0,ye="resize";function Gr(){let e=9,t=3,r=null,o={height:100,width:100},n={height:null,width:null},a=[],l=(m,d)=>a.filter(u=>u.event===m).forEach(u=>u.execute(d)),i=m=>{if(fa(m))return;let d={left:_=>l(ye,{horizontal:T(_),vertical:!1}),top:_=>l(ye,{horizontal:!1,vertical:ee(_)}),right:_=>l(ye,{horizontal:$(_),vertical:!1}),bottom:_=>l(ye,{horizontal:!1,vertical:te(_)}),topleft:_=>l(ye,{horizontal:T(_),vertical:ee(_)}),topright:_=>l(ye,{horizontal:$(_),vertical:ee(_)}),bottomright:_=>l(ye,{horizontal:$(_),vertical:te(_)}),bottomleft:_=>l(ye,{horizontal:T(_),vertical:te(_)})},u=m.node();r.legend&&(u.style.height=r.legend.height,u.style.width=r.legend.width);let p=u.getBoundingClientRect(),f=m.append("svg").attr("id",Hr).attr("width",p.width).attr("height",p.height),h=f.append("g"),g=_=>_==="left"||_==="right",y={left:0,top:e,right:p.width-e,bottom:e},x={left:e,top:0,right:e,bottom:p.height-e},v=["left","top","right","bottom"],[b,w,V,k]=v.map(_=>h.append("rect").attr("id",`drag${_}`).attr("class",g(_)?Ir:Br).attr("y",x[_]).attr("x",y[_]).attr("height",g(_)?p.height-e*2:e).attr("width",g(_)?e:p.width-e*2).attr("fill",g(_)?"lightgreen":"lightblue").attr("fill-opacity",$r).style("z-index",t).attr("cursor",g(_)?"ew-resize":"ns-resize").call(Ke.drag().on("drag",d[_]))),B=_=>`${_[0]}${_[1]}`,j={topleft:"nwse",topright:"nesw",bottomright:"nwse",bottomleft:"nesw"},M=[["top","left"],["top","right"],["bottom","right"],["bottom","left"]],[z,I,E,S]=M.map(_=>h.append("rect").attr("id",`drag${B(_)}`).attr("class",`${pa} ${_[0]} ${_[1]}`).attr("height",e).attr("width",e).attr("fill","red").attr("fill-opacity",$r).style("z-index",t).attr("cursor",`${j[B(_)]}-resize`).call(Ke.drag().on("drag",d[B(_)])));mr("height","y",k),mr("width","x",V),ur(f);function T(_){let L=s(ge(b.node(),_.x,0).x,f,"width",(W,re)=>W-re);return u.style.left=`${u.offsetLeft+L}px`,u.style.width=`${u.offsetWidth-L}px`,le(),je(V,L,"width","x")}function $(_){let L=-s(ge(V.node(),_.dx,0).x,f,"width",(W,re)=>W+re);return c(L,"x",V,_)?!1:(u.style.width=`${u.offsetWidth-L}px`,le(),je(V,L,"width","x"))}function ee(_){let L=s(ge(w.node(),0,_.y).y,f,"height",(W,re)=>W-re);return u.style.top=`${u.offsetTop+L}px`,u.style.height=`${u.offsetHeight-L}px`,le(),je(k,L,"height","y")}function te(_){let L=-s(ge(k.node(),0,_.dy).y,f,"height",(W,re)=>W+re);return c(L,"y",k,_)?!1:(u.style.height=`${u.offsetHeight-L}px`,le(),je(k,L,"height","y"))}function le(){let _={top:u.style.top,left:u.style.left,height:u.style.height,width:u.style.width};r.legend={...r.legend,..._}}function je(_,L,W,re){return ga(f,W,L),ha(_,re,L),da(f,L,W,W==="height"?Ir:Br),ur(f),L!=0}function ur(_){z.attr("y",0,"x",0),I.attr("y",0).attr("x",_.attr("width")-e),E.attr("y",_.attr("height")-e).attr("x",_.attr("width")-e),S.attr("y",_.attr("height")-e).attr("x",0)}function mr(_,L,W){!!n[_]&&n[_]<p[_]&&(u.style[_]=`${n[_]}px`,je(W,p[_]-n[_],_,L))}};i.on=(m,d)=>(a.push({event:m,execute:d}),i),i.zIndex=m=>(t=m,i),i.settings=(...m)=>m.length?(r=m[0],i):r,i.minWidth=m=>(o.width=m,n.width&&(n.width=Math.max(o.width,n.width)),i),i.minHeight=m=>(o.height=m,n.height&&(n.height=Math.max(o.height,n.height)),i),i.handleWidth=m=>(e=m,i),i.maxWidth=m=>(n.width=m,o.width=Math.min(o.width,n.width),i),i.maxHeight=m=>(n.height=m,o.height=Math.min(o.height,n.height),i);function c(m,d,u,p){let f=(g,y,x,v)=>g<0&&v[y]<Number(x.attr(y)),h=(g,y,x,v)=>g>0&&v[y]>Number(x.attr(y));return f(m,d,u,p)||h(m,d,u,p)}function s(m,d,u,p){let f=p(Number(d.attr(u)),m);if(f<o[u]){let h=o[u]-f;return p(m,h)}if(!!n[u]&&f>n[u]){let h=n[u]-f;return p(m,h)}return m}return i}var da=(e,t,r,o)=>{e.selectAll(`.${o}`).each((a,l,i)=>{let c=i[l];Ke.select(c).attr(r,c.getBoundingClientRect()[r]-t)})},fa=e=>e.select(`#${Hr}`).size()>0,ha=(e,t,r)=>e.attr(t,Number(e.attr(t))-r),ga=(e,t,r)=>e.attr(t,e.node().getBoundingClientRect()[t]-r);var jr=16,Wr=20,Zt=(e,t)=>{let r=e||Yr.legendColor(),o=[],n=1,a,l=t.legend&&t.legend.pageIndex?t.legend.pageIndex:0,i=()=>{},c=Rr().settings(t),s,m=b=>{o=r.scale().domain(),s=Gr().settings(t).maxHeight(o.length*jr+Wr).on("resize",()=>d(b)),s(b),c(b),d(b)},d=b=>{g(b),u(b),p(b),Pr(b)},u=b=>{let w=x(b);w.style("display",n<=1?"none":"block"),w.select("#page-text").text(`${l+1}/${n}`),w.select("#up-arrow").attr("class",l===0?"disabled":"").on("click",()=>{l>0&&(f(l-1),d(b))}),w.select("#down-arrow").attr("class",l>=n-1?"disabled":"").on("click",()=>{l<n-1&&(f(l+1),d(b))})},p=b=>{n>1&&r.cellFilter(h()),b.select("g.legendCells").remove();let w=v(b);w.call(r);let V=b.select("g.legendCells").node().getBBox();w.attr("height",V.height+Wr),i(b)},f=b=>{l=b,t.legend={...t.legend,pageIndex:l}},h=()=>(b,w)=>w>=a*l&&w<a*l+a,g=b=>{let w=b.node().getBoundingClientRect(),V=Math.floor(w.height/jr)-1;a=V<o.length?V-1:V,n=y(V),l=Math.min(l,n-1)},y=b=>Math.ceil(o.length/b),x=b=>N(b,".legend-controls",()=>b.append("g").attr("class","legend-controls").html(Dr)),v=b=>N(b,".legend",()=>b.append("svg").attr("class","legend"));return m.decorate=(...b)=>b.length?(i=b[0],m):i,ya(m,r),m};var Ur=e=>Zt(ht.legendColor().shape("circle").shapeRadius(6),e),xa=e=>Zt(ht.legendSymbol().shapePadding(1).labelOffset(3),e),H=()=>Jt(Ur),gt=()=>Jt(xa,Xr),Kr=()=>Jt(Ur,Xr);function Xr(e){if(!e)return null;let t=e.domain(),r=e.range().map(o=>ft.symbol().type(o)());return ft.scaleOrdinal().domain(t).range(r)}function Jt(e,t){let r={},o=null,n=null;function a(l){if(o&&o.range().length>1){let i=e(r);i.scale(o).orient("vertical").on("cellclick",function(s){let m=this.__data__;r.hideKeys=r.hideKeys||[],r.hideKeys.includes(m)?r.hideKeys=r.hideKeys.filter(d=>d!==m):r.hideKeys.push(m),Ne(this)._draw()}),i.labels(s=>{let m=s.domain[s.i].split("|");return r.mainValues.length<=1&&m.length>1?m.slice(0,m.length-1).join("|"):s.domain[s.i]});let c=N(l,"div.legend-container",()=>l.append("div"));i.decorate(s=>{let m=u=>r.hideKeys&&r.hideKeys.includes(u),d=s.select("g.legendCells").attr("transform","translate(20,20)").selectAll("g.cell");d.classed("hidden",m),d.append("title").html(u=>u),n&&d.select("circle, path").style("fill",u=>m(u)?null:n(u)).style("stroke",u=>m(u)?null:J(n(u)))}),c.attr("class","legend-container").attr("borderbox-on-hover",!0).style("z-index","2").call(i)}}return a.settings=(...l)=>l.length?(r=l[0],a):r,a.scale=(...l)=>l.length?(o=t?t(l[0]):l[0],a):o,a.color=(...l)=>l.length?(n=l[0],a):n,a}function K(e,t){let r=t||e.data;return e.hideKeys&&e.hideKeys.length>0?r.map(o=>{let n={...o};return e.hideKeys.forEach(a=>{delete n[a]}),n}):r}function Fe(e,t){let r=t||e.data;return e.hideKeys&&e.hideKeys.length>0?r.map(o=>{let n={};return Object.keys(o).map(a=>{e.hideKeys.includes(fe(a))||(n[a]=o[a])}),n}):r}import*as xe from"d3fc";var ba=e=>t=>t.style("stroke-width","1.0").style("stroke",e?e.colorStyles.grid.gridLineColor:"#bbb"),va=e=>t=>{t.strokeStyle=e?e.colorStyles.grid.gridLineColor:"#bbb",t.lineWidth=1},wa=e=>e.style("display","none"),_a=e=>t=>{t.lineWidth=1,t.strokeStyle=e?e.colorStyles.grid.gridLineColor:"#bbb"},O=(e,t)=>{let r="both",o=!1,n=null,a=null,l=null,i=xe.seriesSvgMulti(),c=xe.annotationSvgGridline(),s=ba(t),m=wa,d=function(...u){o&&(i=xe.seriesCanvasMulti().context(l),c=xe.annotationCanvasGridline(),s=va(t),m=_a(t));let p=i.xScale(n).yScale(a),f=r==="vertical"?m:s,h=r==="horizontal"?m:s,g=c.xDecorate(f).yDecorate(h);return p.series([g,e])(...u)};return d.orient=(...u)=>u.length?(r=u[0],d):r,d.canvas=(...u)=>u.length?(o=u[0],d):o,d.xScale=(...u)=>u.length?(n=u[0],d):n,d.yScale=(...u)=>u.length?(a=u[0],d):a,d.context=(...u)=>u.length?(l=u[0],d):l,d};import*as qr from"d3fc";var P=()=>{let e=rt(),t=r=>{let o=e.pad(),n=e.padUnit(),a=1;switch(n){case"domain":break;case"percent":{a=r[1]-r[0];break}default:throw new Error("Unknown padUnit: "+n)}let l=r[0]-o[0]*a,i=r[1]+o[1]*a;return r[0]=r[0]>=0&&l<0?0:l,r[1]=r[1]<=0&&i>0?0:i,r};return qr.rebindAll(t,e),t};import*as Re from"d3";var Zr=`<button id="zoom-reset">Reset zoom</button>
<button id="one-year">1 Year</button>
<button id="six-months">6 Months</button>
<button id="one-month">1 Month</button>
`;var D=()=>{let e=null,t=null,r=null,o=null,n=null,a=null,l=!1,i=!1,c=()=>{};function s(p){let f=`d3fc-${i?"canvas":"svg"}.plot-area`;if(r||n){let h=o&&o.domain()[0]instanceof Date,g=Re.zoom().on("zoom",x=>{let{transform:v}=x;t.zoom={k:v.k,x:v.x,y:v.y},m(v),p.call(e);let b=v.k===1&&v.x===0&&v.y===0,w=d(p).style("display",b?"none":"");w.select("#zoom-reset").on("click",()=>p.select(f).call(g.transform,Re.zoomIdentity));let V=w.select("#one-year").style("display",h?"":"none"),k=w.select("#six-months").style("display",h?"":"none"),B=w.select("#one-month").style("display",h?"":"none");if(h){let j=M=>()=>{let z=new Date(r.domain()[0]),I=new Date(z);M(z,I);let E=o.range(),S=(E[1]-E[0])/(o(I)-o(z)),T=-o(z)*S,$=0;if(n){let ee=n.domain().reduce((te,le)=>te+le)/2;$=-a(ee)*S+n(ee)}p.select(f).call(g.transform,Re.zoomIdentity.translate(T,$).scale(S))};V.on("click",j((M,z)=>z.setYear(M.getFullYear()+1))),k.on("click",j((M,z)=>z.setMonth(M.getMonth()+6))),B.on("click",j((M,z)=>z.setMonth(M.getMonth()+1)))}}),y=e.decorate();e.decorate((x,v)=>{if(y(x,v),!l){l=!0;let b=x.select(f),w=i?window.devicePixelRatio:1;b.on("measure.zoom-range",V=>{if(o&&o.range([0,V.detail.width/w]),a&&a.range([0,V.detail.height/w]),t.zoom){let k=Re.zoomIdentity.translate(t.zoom.x,t.zoom.y).scale(t.zoom.k);b.call(g.transform,k)}}).call(g)}})}p.call(e)}s.chart=(...p)=>p.length?(e=p[0],s):e,s.settings=(...p)=>p.length?(t=p[0],s):t,s.xScale=(...p)=>p.length?(r=u(p[0]),o=r?r.copy():null,s):r,s.yScale=(...p)=>{if(!p.length)return n;if(n=u(p[0]),a=n?n.copy():null,a){let f=a.domain();a.domain([f[1],f[0]])}return s},s.canvas=(...p)=>p.length?(i=p[0],s):i,s.onChange=(...p)=>p.length?(c=p[0],s):c;let m=p=>{let f={...p};if(r&&(r.domain(p.rescaleX(o).domain()),f.xDomain=r.domain()),n){let h=p.rescaleY(a).domain();n.domain([h[1],h[0]]),f.yDomain=n.domain()}c(f)},d=p=>N(p,".zoom-controls",()=>p.append("div").attr("class","zoom-controls").style("display","none").html(Zr)),u=p=>p&&p.nice?p:null;return s};function Qr(e,t){let r=dt(t,K(t)),o=Z(t),n=H().settings(t).scale(o),a=ct(t,o).orient("horizontal"),l=Jr.seriesSvgMulti().mapping((d,u)=>d[u]).series(r.map(()=>a)),i=A(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[0]).excludeType(C.ordinal).include([0]).paddingStrategy(P())(r),c=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue").orient("vertical")(r),s=Y(i,c).plotArea(O(l,t).orient("horizontal"));s.yPaddingInner&&(s.yPaddingInner(.5),s.yPaddingOuter(.25),a.align("left")),s.xNice&&s.xNice();let m=D().chart(s).settings(t).yScale(c.scale);e.datum(r).call(m),e.call(n)}Qr.plugin={name:"X Bar",category:"X Chart",max_cells:1e3,max_columns:50,render_warning:!0,initial:{names:["X Axis"]}};var en=Qr;import*as cn from"d3fc";var on=(e,t)=>{if(!tn(e)||!tn(t))return;let r=rn(e),o=rn(t);r>o?t[0]=nn(t,r):e[0]=nn(e,o)},tn=e=>e.length===2&&!isNaN(e[0])&&!isNaN(e[1])&&e[0]!==e[1],rn=e=>(0-e[0])/(e[1]-e[0]),nn=(e,t)=>t*e[1]/(t-1);import*as an from"d3fc";var ln=e=>{let t=[],r=!1,o,n=l=>{l.text("");let i=an.dataJoin("span","splitter-label").key(m=>m),c=!r&&t.length===1,s=o&&e.splitValues.length===0;i(l,t).classed("disabled",c).text(m=>m.name).style("color",m=>s?J(o(m.name)):void 0).on("click",(m,d)=>{c||(r?e.splitMainValues=e.splitMainValues.filter(u=>u!=d.name):e.splitMainValues=[d.name].concat(e.splitMainValues||[]),m.target.getRootNode().host.closest("perspective-viewer")?.dispatchEvent(new Event("perspective-config-update")),a(l))})},a=l=>{let i=Ne(l.node());i._container.innerHTML="",i._draw()};return n.labels=(...l)=>l.length?(t=l[0],n):t,n.alt=(...l)=>l.length?(r=l[0],n):r,n.color=(...l)=>l.length?(o=l[0],n):o,n};var be=(e,t,r=Sa)=>{let o,n,a,l=e.splitMainValues||[],i=m=>{let d=m.split("|");return l.includes(d[d.length-1])},c=e.mainValues.some(m=>i(m.name));n=c?r(t,m=>!i(m)):t,a=c?r(t,i):null;let s=m=>{if(e.mainValues.length===1)return;let d=e.mainValues.map((h,g)=>({index:g,name:h.name})),u=d.filter(h=>!i(h.name)),p=d.filter(h=>i(h.name)),f=()=>ln(e).color(o);m.select(".y-label.left-label").call(f().labels(u)),m.select(".y-label.right-label").call(f().labels(p).alt(!0))};return s.color=(...m)=>m.length?(o=m[0],s):o,s.haveSplit=()=>c,s.data=(...m)=>m.length?(n=m[0],s):n,s.altData=(...m)=>m.length?(a=m[0],s):a,s},Sa=(e,t)=>e.map(r=>r.filter(o=>t(o.key))),Qt=(e,t)=>e.map(r=>t(r.key)?r:r.map(o=>Object.assign({},o,{mainValue:null}))),sn=(e,t)=>e.map(r=>Qt(r,t));function un(e,t){let r=dt(t,K(t)),o=Z(t),n=H().settings(t).scale(o),a=ct(t,o).orient("vertical"),l=cn.seriesSvgMulti().mapping((h,g)=>h[g]).series(r.map(()=>a)),i=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue")(r),c=A(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).excludeType(C.ordinal).orient("vertical").include([0]).paddingStrategy(P()),s=t.mainValues.length>1?sn:Qt,m=be(t,r,s).color(o),d=c(m.data()),u=m.haveSplit()?l:O(l,t).orient("vertical"),p=Y(i,d).axisSplitter(m).plotArea(u);p.xPaddingInner&&(p.xPaddingInner(.5),p.xPaddingOuter(.25),a.align("left")),p.yNice&&p.yNice();let f=D().chart(p).settings(t).xScale(i.scale);if(m.haveSplit()){let h=c(m.altData());on(d.domain,h.domain),p.yDomain(d.domain).altAxis(h)}e.datum(m.data()).call(f),e.call(n)}un.plugin={name:"Y Bar",category:"Y Chart",max_cells:1e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var mn=un;import*as fn from"d3fc";import*as pn from"d3fc";function Be(e,t){let r=pn.seriesSvgLine(),o=e.data.length*(e.data?.length>0?Object.keys(e.data[0]).length-(e.crossValues?.length>0?1:0):0),n=Math.max(1,Math.min(3,Math.floor(e.size.width/o/2)));return r=r.decorate(a=>{a.style("stroke",l=>J(t(l[0]&&l[0].key))).style("stroke-width",n)}),r.crossValue(a=>a.crossValue).mainValue(a=>a.mainValue)}function dn(e,t){let r=U(e);return t.map((o,n)=>Object.keys(o).filter(a=>a!=="__ROW_PATH__").map(a=>({key:a,crossValue:r(o,n),mainValue:o[a],row:o})))}var yt=function(e){let t=[];for(let r of e)for(let o=0;o<r.length;o++)r[o].mainValue!==null&&(t[o]=t[o]||[],t[o].push(r[o]));return t};import*as xt from"d3fc";var er=(e,t,r=Math.min)=>{let o=l=>l.reduce((i,c)=>{let s=n(c,t);return s&&(!i||r(i.value,s.value)===s.value)?s:i},null),n=l=>{if(Array.isArray(l))return o(l,t);let i=t(l);return i!==null?{item:l,value:i}:null},a=o(e,t);return a?a.item:null};var G=()=>{let e=de().alwaysShow(!0),t=null,r=null,o=null,n=null,a=!1,l=null,i="crossValue",c="mainValue",s=null,m=1;function d(f){let h=`d3fc-${a?"canvas":"svg"}.plot-area`;if(t||r){let g=null,y=xt.pointer().on("point",x=>{let v=x.length?p(x[0]):null;g=v?[v.data]:[];let b=v?v.scale:r;u(f,g,b)});f.select(h).on("measure.nearbyTip",()=>u(f,[])).on("click",()=>{g.length&&Ue(f.node(),g[0],e.settings())}).call(y)}}let u=(f,h,g=r)=>{let y=f.select("d3fc-svg.plot-area svg").selectAll("circle.nearbyTip").data(h);y.exit().remove(),y.enter().append("circle").attr("class","nearbyTip").merge(y).attr("r",x=>n?m*Math.sqrt(n(x.size)):10).attr("transform",x=>`translate(${t(x[i])},${g(x[c])})`).style("stroke","none").style("fill",x=>o&&x.key&&Se(o(x.key))),e(y)},p=f=>{let h=x=>v=>v[c]===void 0||v[c]===null||v[i]===void 0||v[i]===null?null:Math.sqrt(Math.pow(t(v[i])-f.x,2)+Math.pow(x(v[c])-f.y,2)),g=h(r),y=er(l,g,Math.min);if(s){let x=h(s.yScale),v=er(s.data,x,Math.min);return g(y)<=x(v)?{data:y,scale:r}:{data:v,scale:s.yScale}}return{data:y,scale:r}};return d.scaleFactor=(...f)=>f.length?(m=f[0],d):m,d.xScale=(...f)=>f.length?(t=f[0],d):t,d.yScale=(...f)=>f.length?(r=f[0],d):r,d.color=(...f)=>f.length?(o=f[0],d):o,d.size=(...f)=>f.length?(n=f[0]?f[0].copy().range([40,4e3]):null,d):n,d.canvas=(...f)=>f.length?(a=f[0],d):a,d.data=(...f)=>f.length?(l=f[0],d):l,d.xValueName=(...f)=>f.length?(i=f[0],d):i,d.yValueName=(...f)=>f.length?(c=f[0],d):c,d.altDataWithScale=(...f)=>f.length?(s=f[0],d):s,xt.rebindAll(d,e),d};function hn(e,t){let r=dn(t,K(t)),o=Z(t),n=H().settings(t).scale(o),a=fn.seriesSvgRepeat().series(Be(t,o)).orient("horizontal"),l=P().pad([.1,.1]).padUnit("percent"),i=be(t,yt(r)).color(o),c=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue")(r),s=A(t).settingName("mainValues").valueName("mainValue").memoValue(i.haveSplit()?null:t.axisMemo[0]).orient("vertical").paddingStrategy(l),m=s(i.data()),d=i.haveSplit()?a:O(a,t).orient("vertical"),u=Y(c,m).axisSplitter(i).plotArea(d);u.yNice&&u.yNice();let p=D().chart(u).settings(t).xScale(c.scale),f=G().settings(t).xScale(c.scale).yScale(m.scale).color(o).data(r);if(i.haveSplit()){let g=s(i.altData());u.altAxis(g),f.data(i.data()).altDataWithScale({yScale:g.scale,data:i.altData()})}let h=i.data();e.datum(h).call(p),e.call(f),e.call(n)}hn.plugin={name:"Y Line",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var gn=hn;import*as bn from"d3fc";import{seriesCanvasPoint as Aa}from"d3fc";import*as F from"d3";var Ca=[F.symbolCircle,F.symbolCross,F.symbolDiamond,F.symbolSquare,F.symbolStar,F.symbolTriangle,F.symbolWye];function bt(e){return e.length>1?F.scaleOrdinal().domain(e).range(Ca):null}var ka=8,Ta=1;function yn(e,t,r,o,n,a,l=1){let i=Aa().crossValue(c=>c.x).mainValue(c=>c.y);return r&&i.size(c=>Math.round(l*r(c.size))),a&&i.type(a(t)),i.decorate((c,s)=>{let m=o(s.colorValue!==void 0?s.colorValue:t),d=e.colorStyles&&e.colorStyles.opacity;if(n){let{type:u}=e.mainValues.find(f=>f.name===n),p=ne(u,s.row[n]);if(p!==null){c.fillStyle=e.textStyles.color,c.font=e.textStyles.font;let f=0;r&&(f=Math.sqrt(l*r(s.size)/Math.PI)*Ta);let h=f+ka;c.fillText(p,h,4)}}c.strokeStyle=J(m),c.fillStyle=Se(m,d)}),i}function vt(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=[];return Object.keys(t).forEach(o=>{if(o!=="__ROW_PATH__"){let n=fe(o);r.includes(n)||r.push(n)}}),bt(r)}function xn(e,t){let r=e.mainValues.length;return t.map(o=>{let n=Object.keys(o).filter(l=>l!=="__ROW_PATH__"),a=new Array(n.length/r);for(let l=0;l<n.length/r;l++)a[l]={key:fe(n[l*r]),crossValue:o[n[l*r]],mainValue:o[n[l*r+1]],row:o};return a})}function vn(e,t){let r=yt(xn(t,Fe(t))),o=pt(t),n=vt(t),a=null;o.domain().length>=2&&(a=Kr().settings(t).scale(n).color(o));let l=bn.seriesSvgRepeat().series(Be(t,o)).orient("horizontal"),i=P().pad([.1,.1]).padUnit("percent"),c=A(t).settingName("mainValues").settingValue(t.mainValues[0].name).valueName("crossValue").memoValue(t.axisMemo[0]).paddingStrategy(i),m=A(t).settingName("mainValues").settingValue(t.mainValues[1].name).valueName("mainValue").memoValue(t.axisMemo[1]).orient("vertical").paddingStrategy(i)(r),d=c(r),u=O(l,t).orient("vertical"),p=Y(d,m).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(u);p.xNice&&p.xNice(),p.yNice&&p.yNice();let f=D().chart(p).settings(t).xScale(d.scale).yScale(m.scale),h=G().settings(t).xScale(d.scale).yScale(m.scale).color(o).data(r);e.datum(r).call(f),e.call(h),a&&e.call(a)}vn.plugin={name:"X/Y Line",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Tooltip"]},selectMode:"toggle"};var wn=vn;import*as Xe from"d3fc";import*as _n from"d3fc";function Vn(e,t){let r=_n.seriesSvgArea();return r=r.decorate(o=>{o.style("fill",n=>t(n[0].key)).style("opacity",.5)}),r.crossValue(o=>o.crossValue).mainValue(o=>o.mainValue).baseValue(o=>o.baseValue)}function Sn(e,t){let r=U(e);return t.map((o,n)=>{let a={};return Object.keys(o).filter(l=>l!=="__ROW_PATH__").map(l=>{let i=l.split("|"),c=i[i.length-1],s=a[c]||0,m=s+o[l];return a[c]=m,{key:l,crossValue:r(o,n),mainValue:m,baseValue:s,row:o}})})}function Cn(e,t){let r=Sn(t,K(t)),o=Z(t),n=H().settings(t).scale(o),a=Xe.seriesSvgRepeat().series(Vn(t,o).orient("vertical")),l=Xe.seriesSvgRepeat().series(Be(t,o)).orient("vertical"),i=Xe.seriesSvgMulti().series([a,l]),c=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue")(r),s=A(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).excludeType(C.ordinal).orient("vertical").include([0]).paddingStrategy(P()),m=be(t,r).color(o),d=s(m.data()),u=m.haveSplit()?i:O(i,t).orient("vertical"),p=Y(c,d).axisSplitter(m).plotArea(u);p.yNice&&p.yNice();let f=D().chart(p).settings(t).xScale(c.scale),h=G().settings(t).xScale(c.scale).yScale(d.scale).color(o).data(r);if(m.haveSplit()){let g=s(m.altData());p.altAxis(g),h.data(m.data()).altDataWithScale({yScale:g.scale,data:m.altData()})}e.datum(m.data()).call(f),e.call(h),e.call(n)}Cn.plugin={name:"Y Area",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var An=Cn;import*as zn from"d3fc";import*as kn from"d3fc";function Tn(e,t,r,o){let n=kn.seriesSvgPoint().size(100),a=e.colorStyles&&e.colorStyles.opacity;return o&&n.type(o(t)),n.decorate(l=>{l.style("stroke",i=>J(r(i.colorValue||t))).style("fill",i=>Se(r(i.colorValue||t),a))}),n.crossValue(l=>l.crossValue).mainValue(l=>l.mainValue)}function Ln(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=Object.keys(t).filter(o=>o!=="__ROW_PATH__");return bt(r)}function En(e,t){let r=Nr(t,K(t)),o=Ln(t),n=Z(t),a=gt().settings(t).scale(o).color(n),l=zn.seriesSvgMulti().mapping((g,y)=>g[y]).series(r.map(g=>Tn(t,g.key,n,o))),i=P().pad([.05,.05]).padUnit("percent"),c=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue")(r),s=A(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).orient("vertical").paddingStrategy(i),m=be(t,r).color(n),d=s(m.data()),u=m.haveSplit()?l:O(l,t).orient("vertical"),p=Y(c,d).axisSplitter(m).plotArea(u);p.yNice&&p.yNice();let f=D().chart(p).settings(t).xScale(c.scale),h=G().settings(t).xScale(c.scale).yScale(d.scale).color(n).data(r);if(m.haveSplit()){let g=s(m.altData());p.altAxis(g),h.data(m.data()).altDataWithScale({yScale:g.scale,data:m.altData()})}e.datum(m.data()).call(f),e.call(h),a&&e.call(a)}En.plugin={name:"Y Scatter",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var Mn=En;import*as Pn from"d3fc";function Nn(e,t){return Ae(e,t,{excludeEmpty:!0}).map(r=>La(e,r))}function La(e,t){let r=U(e),o=t.map((n,a)=>({crossValue:r(n,a),mainValues:e.mainValues.map(l=>n[l.name]),x:n[e.mainValues[0].name],y:n[e.mainValues[1].name],colorValue:e.realValues[2]?n[e.realValues[2]]:void 0,size:e.realValues[3]?n[e.realValues[3]]:void 0,key:t.key,row:n}));return o.key=t.key,o}import*as Ie from"d3";function On(e,t,r,o){return Ie.scaleLinear().domain(Dn(t,r,o))}function ve(e,t,r,o){let n=Dn(t,r,o),a=e.colorStyles.gradient.full;if(n[0]>=0)a=e.colorStyles.gradient.positive;else if(n[1]<=0)a=e.colorStyles.gradient.negative;else{let i=Math.max(-n[0],n[1]);n=[-i,i]}let l=za(a);return Ie.scaleSequential(l).domain(n)}var Dn=(e,t,r)=>r||Bt().valueName(t).pad([0,0])(e),za=e=>{let t=e.slice(1).map((r,o)=>Ie.interpolate(e[o][1],r[1]));return r=>{let o=e.findIndex((i,c)=>c<e.length-1&&r<=e[c+1][0]&&r>i[0]);if(o===-1)return r<=e[0][0]?e[0][1]:e[e.length-1][1];let n=t[o],[a]=e[o],[l]=e[o+1];return n((r-a)/(l-a))}};import*as $e from"d3";import*as we from"d3fc";function _e(){let e=null;function t(r){let o=N(r,"div.legend-container",()=>r.append("div").attr("class","legend-container legend-color").style("z-index","2")),{width:n,height:a}=o.node().getBoundingClientRect(),l=$e.scaleBand().domain([0,1]).range([0,n]),i=e.copy().nice().domain(),c=we.extentLinear().pad([.1,.1]).padUnit("percent")(i),[s,m]=c,d=$e.range(s,m,(m-s)/a),u=$e.scaleLinear().domain(c).range([a,0]),p=we.autoBandwidth(we.seriesSvgBar()).xScale(l).yScale(u).crossValue(0).baseValue((b,w)=>d[Math.max(0,w-1)]).mainValue(b=>b).decorate(b=>{b.selectAll("path").style("fill",w=>e(w))}),f=i[0]<0&&i[1]>0?0:Math.round((i[1]+i[0])/2),h=[...i,f],g=we.axisRight(u).tickValues(h).tickSizeOuter(0).tickFormat(b=>ot(b)),y=N(o,"svg",()=>o.append("svg")).style("width",n).style("height",a),x=N(y,"g",()=>y.append("g")).datum(d).call(p),v=Math.abs(x.node().getBBox().x);N(y,"#legend-axis",()=>y.append("g").attr("id","legend-axis")).attr("transform",`translate(${v})`).datum(d).call(g).select(".domain").attr("visibility","hidden")}return t.scale=(...r)=>r.length?(e=r[0],t):e,t}function Ea([e,t],[r,o]){let n=(o-t)/(r-e),a=o-n*r;return function(l){let i=l.node(),c=Math.min(i.clientWidth,i.clientHeight);return Math.min(o,Math.max(t,n*c+a))}}function Fn(e,t){let r=Nn(t,Fe(t)),o=vt(t),n=t.realValues.length<=2||t.realValues[2]===null,a=null,l=null;n?(a=pt(t),l=gt().settings(t).scale(o).color(n?a:null)):(a=ve(t,r,"colorValue"),l=_e().scale(a));let i=t.realValues[3]?On(t,r,"size").range([10,1e4]):null,c=t.realValues[4],s=Ea([600,.1],[1600,1])(e),m=Pn.seriesCanvasMulti().mapping((y,x)=>y[x]).series(r.map(y=>yn(t,y.key,i,a,c,o,s))),d=()=>A(t).settingName("mainValues").paddingStrategy(P()).pad([.1,.1]),u=d().settingValue(t.mainValues[0].name).memoValue(t.axisMemo[0]).valueName("x")(r),p=d().orient("vertical").settingValue(t.mainValues[1].name).memoValue(t.axisMemo[1]).valueName("y")(r),f=De(u,p).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(O(m,t).canvas(!0));f.xNice&&f.xNice(),f.yNice&&f.yNice();let h=D().chart(f).settings(t).xScale(u.scale).yScale(p.scale).canvas(!0),g=G().scaleFactor(s).settings(t).canvas(!0).xScale(u.scale).xValueName("x").yValueName("y").yScale(p.scale).color(n&&a).size(i).data(r);e.datum(r).call(h),e.call(g),l&&e.call(l)}Fn.plugin={name:"X/Y Scatter",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Color","Size","Label","Tooltip"]},selectMode:"toggle"};var Rn=Fn;import*as wt from"d3fc";function Bn(e,t){let r=wt.seriesCanvasHeatmap();return r.decorate((o,n)=>{o.fillStyle=t(n.colorValue)}),wt.autoBandwidth(r).xValue(o=>o.crossValue).yValue(o=>o.mainValue).colorValue(o=>o.colorValue).colorInterpolate(t.interpolator()).widthFraction(1)}function In(e,t){let r=U(e),o=Me(e).excludeType(C.linear).settingName("splitValues")(),n=[];return t.forEach((a,l)=>{let i=r(a,l);Object.keys(a).filter(c=>c!=="__ROW_PATH__").forEach(c=>{let s=Ma(c);n.push({crossValue:i,mainValue:o===C.time?new Date(s):s,colorValue:a[c],row:a})})}),n}function Ma(e){let t=e.split("|");return t.pop(),t.join("|")}function $n(e,t){let r=In(t,K(t)),o=ve(t,r,"colorValue"),n=Bn(t,o),a=_e().scale(o),l=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue")(r),i=A(t).excludeType(C.linear).settingName("splitValues").valueName("mainValue").modifyDomain(d=>!isNaN(d[0])?d.reverse():d).orient("vertical")(r),c=De(l,i).plotArea(O(n,t).canvas(!0));c.xPaddingInner&&(c.xPaddingInner(0),c.xPaddingOuter(0),n.xAlign("right")),c.yPaddingInner&&(c.yPaddingInner(0),c.yPaddingOuter(0),n.yAlign("top"));let s=D().chart(c).settings(t).xScale(l.scale).yScale(i.scale).canvas(!0),m=G().settings(t).canvas(!0).xScale(l.scale).yScale(i.scale).color(o).data(r);e.datum(r).call(s),e.call(a),e.call(m)}$n.plugin={name:"Heatmap",category:"Hierarchial Chart",max_cells:5e4,max_columns:500,render_warning:!0,initial:{names:["Color"]}};var Hn=$n;import{seriesCanvasOhlc as Pa}from"d3fc";import*as _t from"d3fc";function Gn(e,t){return Ae(e,t,{excludeEmpty:!0}).map(r=>Na(e,r))}function Na(e,t){let r=U(e),o=a=>t[a<t.length-1?a+1:a][e.realValues[0]],n=t.map((a,l)=>{let i=e.realValues[0]?a[e.realValues[0]]:void 0,c=e.realValues[1]?a[e.realValues[1]]:o(l);return{crossValue:r(a,l),mainValues:e.mainValues.map(s=>a[s.name]),openValue:i,closeValue:c,highValue:e.realValues[2]?a[e.realValues[2]]:Math.max(i,c),lowValue:e.realValues[3]?a[e.realValues[3]]:Math.min(i,c),key:t.key,row:a}});return n.key=t.key,n}import*as He from"d3fc";var Oa=e=>e.closeValue>=e.openValue;function jn(e,t,r){let o=r.domain(),n=he().domain(o).settings(e).defaultColors([e.colorStyles["series-2"]]).mapFunction(Ce(.5))(),a=he().settings(e).domain(o)(),l=t().crossValue(s=>s.crossValue).openValue(s=>s.openValue).highValue(s=>s.highValue).lowValue(s=>s.lowValue).closeValue(s=>s.closeValue).decorate((s,m)=>{let d=Oa(m)?r(m.key):n(m.key);s.fillStyle=d,s.strokeStyle=d}),i=He.seriesCanvasLine().mainValue(s=>s.bollinger.average).crossValue(s=>s.crossValue).decorate((s,m)=>{s.strokeStyle=a(m[0].key)}),c=He.seriesCanvasArea().mainValue(s=>s.bollinger.upper).baseValue(s=>s.bollinger.lower).crossValue(s=>s.crossValue).decorate((s,m)=>{s.fillStyle=Ce(.25)(a(m[0].key))});return He.seriesCanvasMulti().series([c,l,i])}function Da(e){return function(t,r){let o=Gn(r,Fe(r)),n=_t.indicatorBollingerBands().value(y=>y.openValue),a=o.map(y=>{let x=n(y);return y.map((v,b)=>Object.assign({bollinger:x[b]},v))}),l=o.map(y=>y.key).concat(r.hideKeys?r.hideKeys:[]).sort(),i=he().domain(l).settings(r).mapFunction(Ce(1))(),c=H().settings(r).scale(l.length>1?i:null),s=jn(r,e,i),m=_t.seriesCanvasMulti().mapping((y,x)=>y[x]).series(a.map(()=>s)),d=P().pad([.1,.1]).padUnit("percent"),u=A(r).settingName("crossValues").valueName("crossValue")(a),p=A(r).settingName("mainValues").valueNames(["lowValue","highValue"]).memoValue(r.axisMemo[1]).orient("vertical").paddingStrategy(d)(a),f=De(u,p).plotArea(O(m,r).orient("vertical").canvas(!0));f.yNice&&f.yNice();let h=D().chart(f).settings(r).xScale(u.scale).onChange(y=>{let x=a.map(v=>v.filter(b=>b.crossValue>=y.xDomain[0]&&b.crossValue<=y.xDomain[1]));f.yDomain(p.domainFunction(x))}).canvas(!0),g=G().settings(r).xScale(u.scale).yScale(p.scale).yValueName("closeValue").color(i).data(a).canvas(!0);t.datum(a).call(h),t.call(g),t.call(c)}}var Vt=Da;var Wn=Vt(Pa);Wn.plugin={name:"OHLC",category:"Y Chart",max_cells:3500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Open","Close","High","Low","Tooltip"]},selectMode:"toggle"};var Yn=Wn;import{seriesCanvasCandlestick as Fa}from"d3fc";var Un=Vt(Fa);Un.plugin={name:"Candlestick",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Open","Close","High","Low","Tooltip"]},selectMode:"toggle"};var Kn=Un;import{select as eo}from"d3";function Xn(e,t){if(e.realValues.length>1&&e.realValues[1]!==null){let r=e.realValues[1];if(e.mainValues.find(o=>o.name===r)?.type==="string"){let o=t.map(n=>n.data).filter(n=>n.height>0).map(n=>qn(n)).reduce((n,a)=>n.concat(a));return mt(e,o)}else return ve(e,null,null,pr(t.map(o=>o.extents)))}}function qn(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(r=>t.concat(qn(r,t))):e.data.color&&t.push(e.data.color),t}import*as St from"d3";function Ct(e){let t={},r=e.realValues.map(n=>n===null?null:e.mainValues.find(a=>a.name===n));return e.data.forEach((n,a)=>{let l=n.__ROW_PATH__;Ba(n).forEach(c=>{let s;t[c]||(t[c]=[]),s=t[c],l.forEach((m,d)=>{let u=s.find(p=>p.name===m);if(u||(u={name:m,children:[]},s.push(u)),e.realValues.length>1&&e.realValues[1]!==null){let p=d===l.length-1,f=Ge(p?n:e.agg_paths[a][d+1]||n,e.mainValues[1],c);f!==void 0&&(u.color=f)}if(e.realValues.length>2&&e.realValues[2]!==null){u.tooltip=[];for(let p=2;p<e.realValues.length;++p)u.tooltip.push(Ge(n,r[p],c))}if(d===l.length-1){if(u.name=l.slice(-1)[0],e.crossValues.length===0)u.size=Ge(n,e.mainValues[0],"");else if(l.length===e.crossValues.length){let p=Ge(n,e.mainValues[0],c);u.size=p>0?p:0}}s=u.children})})}),Object.entries(t).map(n=>{let a={name:"root",children:n[1]},l=St.hierarchy(a).sum(c=>c.size),i=St.partition().size([2*Math.PI,l.height+1])(l);return i.each(c=>{c.current=c,c.mainValues=e.realValues.length===1||e.realValues[1]===null&&e.realValues[2]===null?c.value:[c.value,c.data.color].concat(c.data.tooltip||[]).filter(s=>s!==void 0),c.crossValue=c.ancestors().slice(0,-1).reverse().map(s=>s.data.name),c.key=n[0],c.label=ne(e.crossValues[c.depth-1<0?0:c.depth-1]?.type||e.mainValues[0].type,c.data.name)}),{split:n[0],data:i,extents:Ra(e,n)}})}var Ge=(e,t,r)=>r.length?e[`${r}|${t.name}`]:e[t.name];function Ra(e,[t,r]){if(e.realValues.length>1&&e.realValues[1]!==null){let o=Math.min(...e.data.map(a=>Ge(a,e.mainValues[1],t))),n=Math.max(...r.map(a=>a.color));return[o,n]}}function Ba(e){let t=[];return Object.keys(e).forEach(r=>{if(r!=="__ROW_PATH__"){let o=r.split("|").slice(0,-1).join("|");t.includes(o)||t.push(o)}}),t}import{arc as Ia}from"d3";var At=e=>Ia().startAngle(t=>t.x0).endAngle(t=>t.x1).padAngle(t=>Math.min((t.x1-t.x0)/2,.005)).padRadius(e).innerRadius(t=>Math.max(1,(t.y0-1)*e)).outerRadius(t=>Math.max((t.y0-1)*e,(t.y1-1)*e-1)),ae=e=>e.y0>=1&&e.x1>e.x0;import{select as $a}from"d3";var qe=e=>e.y1<=3&&e.y0>=1&&(e.y1-e.y0)*(e.x1-e.x0)>.06;function kt(e,t){let r=(e.x0+e.x1)/2*180/Math.PI,o=(e.y0-1+(e.y1-1))/2*t;return`rotate(${r-90}) translate(${o},0) rotate(${r<180?0:180})`}function Zn(e,t){let r=this.getBBox().width;if(r>t){let o=e.label,n=$a(this);for(;r>t;)o=o.substring(0,o.length-1),n.text(()=>o),r=this.getBBox().width;n.text(()=>`${o.substring(0,o.length-3).replace(/\s+$/,"")}...`)}}import{interpolate as Ha}from"d3";var Jn=(e,t,r,o,n,a,l,i,c)=>(s,m)=>{c.sunburstLevel[i]=s.data.name,s.parent?(r.datum(s.parent),r.style("cursor","pointer"),o.html(`&#8682; ${s.label}`)):(r.datum(e),r.style("cursor","default"),o.html("")),e.each(u=>u.target={x0:Math.max(0,Math.min(1,(u.x0-s.x0)/(s.x1-s.x0)))*2*Math.PI,x1:Math.max(0,Math.min(1,(u.x1-s.x0)/(s.x1-s.x0)))*2*Math.PI,y0:Math.max(0,u.y0-s.depth),y1:Math.max(0,u.y1-s.depth)});let d=t.transition().duration(m?0:750);n.transition(d).tween("data",u=>{let p=Ha(u.current,u.target);return f=>u.current=p(f)}).filter(function(u){return+this.getAttribute("fill-opacity")||ae(u.target)}).attr("fill-opacity",u=>ae(u.target)?1:0).attr("user-select",u=>ae(u.target)?"initial":"none").style("pointer-events",u=>ae(u.target)?"initial":"none").attrTween("d",u=>()=>At(l)(u.current)),a.filter(function(u){return+this.getAttribute("fill-opacity")||qe(u.target)}).transition(d).attr("fill-opacity",u=>+qe(u.target)).attrTween("transform",u=>()=>kt(u.current,l))};function Qn(){let e=null,t=null,r=null,o=null,n=null,a=l=>{let i=l.selectAll("g.segment").data(r.descendants().slice(1)),c=i.enter().append("g").attr("class","segment");c.append("path"),c.append("text").attr("class","segment").attr("dy","0.35em");let s=c.merge(i),m=s.select("path").attr("fill-opacity",h=>ae(h.current)?1:0).attr("user-select",h=>ae(h.current)?"initial":"none").style("pointer-events",h=>ae(h.current)?"initial":"none").attr("d",h=>At(n)(h.current));o&&m.style("fill",h=>o(h.data.color));let d=s.select("text").attr("fill-opacity",h=>+qe(h.current)).attr("transform",h=>kt(h.current,n)).text(h=>h.label).each(function(h){Zn.call(this,h,n)}),u=l.select("text.parent"),p=l.select("circle").attr("r",n).datum(r),f=Jn(r,l,p,u,m,d,n,t,e);if(e.sunburstLevel){let h=r.descendants().find(g=>g.data.name===e.sunburstLevel[t]);h&&f(h,!0)}else e.sunburstLevel={};p.on("click",h=>f(h,!1)),m.filter(h=>h.children).style("cursor","pointer").on("click",h=>f(h,!1))};return a.settings=(...l)=>l.length?(e=l[0],a):e,a.split=(...l)=>l.length?(t=l[0],a):t,a.data=(...l)=>l.length?(r=l[0],a):r,a.color=(...l)=>l.length?(o=l[0],a):o,a.radius=(...l)=>l.length?(n=l[0],a):n,a}function Tt(){let e="element-prefix-unset",t=null,r=null,o=null,n=null,a=null,l=null,i=c=>{let s=N(c,"div.inner-container",()=>c.append("div").attr("class","inner-container")),m=s.node().getBoundingClientRect(),d=m.height,u=m.width-(a?70:0),p=300,f=c.datum(),h=Math.max(1,Math.min(f.length,Math.floor(u/p))),g=Math.ceil(f.length/h);l={width:u/Math.max(h,1),height:Math.min(d,Math.max(d/g,u/Math.max(h,1)))},d/g>l.height*.75&&(l.height=d/g),f.length>1?(s.style("grid-template-columns",`repeat(${h}, ${100/h}%)`),s.style("grid-template-rows",`repeat(${g}, ${l.height}px)`)):(s.style("grid-template-columns","repeat(1, 100%)"),s.style("grid-template-rows","repeat(1, 100%)")),o=s.selectAll(`div.${e}-container`).data(f,y=>y.split),o.exit().remove(),r=o.enter().append("div").attr("class",`${e}-container`),n=r.append("div").attr("class","title-container").style("text-align","center").attr("display","inline-block").append("text").attr("class","title").style("text-align","left"),t=r.append("svg").append("g").attr("class",e)};return i.elementsPrefix=(...c)=>c.length?(e=c[0],i):e,i.chartContainer=()=>t,i.chartEnter=()=>r,i.chartDiv=()=>o,i.chartTitle=()=>n,i.containerSize=()=>l,i}function to(e,t){let r=Ct(t),o=Xn(t,r),n=Tt().elementsPrefix("sunburst");if(e.datum(r).call(n),o){let m=t.realValues[1];if(t.mainValues.find(d=>d.name===m)?.type==="string"){let d=H().settings(t).scale(o);e.call(d)}else{let d=_e().scale(o);e.call(d)}}let a=n.chartContainer(),l=n.chartEnter(),i=n.chartDiv(),c=n.chartTitle(),s=n.containerSize();c.each((m,d,u)=>eo(u[d]).text(m.split)),a.append("circle").attr("fill","none").style("pointer-events","all"),a.append("text").attr("class","parent"),l.merge(i).select("svg").select("g.sunburst").attr("transform",`translate(${s.width/2}, ${s.height/2})`).each(function({split:m,data:d}){let u=eo(this),p=this.parentNode,{width:f,height:h}=p.getBoundingClientRect(),g=(Math.min(f,h)-24)/Math.max(2,t.crossValues.length*2);Qn().settings(t).split(m).data(d).color(o).radius(g)(u),de().settings(t)(u.selectAll("g.segment"))})}to.plugin={name:"Sunburst",category:"Hierarchial Chart",max_cells:7500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var ro=to;import*as Qe from"d3";function no(e,t){if(e.realValues.length<1||e.realValues[1]===null||e.realValues[1]===void 0)return;let r=e.realValues[1],o=t.filter(n=>n.height>0).map(n=>oo(n)).reduce((n,a)=>n.concat(a));if(e.mainValues.find(n=>n.name===r)?.type==="string")return mt(e,o);{let n=Math.min(...o),a=Math.max(...o);return ve(e,null,null,[n,a])}}function oo(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(r=>t.concat(oo(r,t))):e.data.color&&t.push(e.data.color),t}import{select as R}from"d3";var ao=7,Lt=e=>!!(e.target&&e.target.textAttributes),zt=(e,t,r)=>{e.selectAll("text").each(function(n,a){let l=Ya(n,t,r);this.style=l});let o=Je(e);Ga(o),tr(o)},lo=e=>{e.each((t,r,o)=>{R(o[r]).selectAll("text").attr("dx",t.target.textAttributes.dx).attr("dy",t.target.textAttributes.dy).attr("style",t.target.textAttributes.style)})},tr=e=>{let o=a=>a.getBoundingClientRect(),n=[];e.selectAll("text").filter((a,l,i)=>R(i[l]).attr("style")===Le.high).each((a,l,i)=>n.push(i[l])),e.selectAll("text").filter((a,l,i)=>R(i[l]).attr("style")===Le.low).each((a,l,i)=>{let c=i[l];n.filter(s=>Yt("x",o(s),o(c))&&Yt("y",o(s),o(c),-2)).forEach(()=>R(c).attr("dy",Number(R(c).attr("dy"))+14))})},io=e=>R(e).style("opacity",Ze[R(e).attr("class")]),so=e=>R(e).style("opacity",null),Ze={top:1,mid:.7,lower:0},Je=e=>e.filter((t,r,o)=>R(o[r]).selectAll("text").attr("style")!==Le.zero),Et=e=>e.selectAll("text").each((t,r,o)=>ja(o[r])),Ga=e=>e.selectAll("text").each((t,r,o)=>co(o[r])),co=e=>{let t=R(e),r=e.getBoundingClientRect();t.attr("dx",0-r.width/2).attr("dy",0+r.height/4)},ja=e=>{let r=e.parentNode.childNodes[0],o=e.getBBox(),n=r.getBBox();Wa(e,n,o)||R(e).attr("style",R(e).attr("style"))},Wa=(e,t,r)=>{let o=Math.min(t.height/r.height,t.width/r.width);if(o<1){let n=parseInt(R(e).style("font-size")),a=Math.floor(n*o);return n>ao&&a>ao?(R(e).style("font-size",`${a}px`),co(e)):(R(e).style("font-size",null),R(e).style("opacity","0")),!0}return!1},Ya=(e,t,r)=>{if(!r.filter(o=>o!=="").every(o=>e.crossValue.includes(o)))return Le.zero;switch(e.depth){case t+1:return Le.high;case t+2:return Le.low;default:return Le.zero}},Le={high:"font-size:14px;z-index:5;pointer-events: none;",low:"font-size:8px;opacity:0.7;z-index:4;",zero:"font-size:0px;opacity:0;z-index:4;"};import*as Mt from"d3";var Nt=(e,t)=>{let r=Mt.treemap().size([e,t]).paddingInner(o=>1+2*(o.height-1));return r.tile(Mt.treemapBinary),r};import*as Q from"d3";import{hierarchy as Ua,select as rr}from"d3";var Ka=(e,t)=>t.every(r=>e.crossValue.includes(r));function nr(e,t,r,o,n,a){Xa(e,t,r,o,n),e.mapLevel[o].levelRoot=!0,qa(e,a.node().getBoundingClientRect().width,a.node().getBoundingClientRect().height,o),mo(r,o)}function uo(e,t){e.each(r=>{r.mapLevel=[],r.mapLevel[0]={x0:r.x0,x1:ze(r)+r.x0,y0:r.y0,y1:Ee(r)+r.y0,visible:!0,opacity:1}}),t.mapLevel[0].levelRoot=!0,mo(e,0)}var Ot=(e,t)=>{e.each((r,o,n)=>{let a=rr(n[o]).selectAll("text");r.mapLevel[t].textAttributes={dx:a.attr("dx"),dy:a.attr("dy"),class:a.attr("class"),"font-size":a.style("font-size")}})};function Xa(e,t,r,o,n){let a={x:e.x0,y:e.y0,width:e.x1-e.x0,height:e.y1-e.y0},l={width:n.x1-n.x0,height:n.y1-n.y0},i={width:l.width/a.width,height:l.height/a.height};r.each(c=>{let s=(c.x0-a.x)*i.width,m=(c.y0-a.y)*i.height,d=ze(c)*i.width,u=Ee(c)*i.height,p=Ka(c,t)&&c.data.name!==t[o-1];c.mapLevel[o]={x0:s,x1:d+s,y0:m,y1:u+m,visible:p,opacity:p?1:0}}),e.mapLevel[o].levelRoot=!0}function qa(e,t,r,o){let l=Nt(t,r)(Ua(e.data).sum(c=>c.size)).descendants(),i=e.descendants();l.forEach((c,s)=>{i[s].mapLevel[o].x0=l[s].x0,i[s].mapLevel[o].x1=l[s].x1,i[s].mapLevel[o].y0=l[s].y0,i[s].mapLevel[o].y1=l[s].y1})}function mo(e,t){e.selectAll("text").each((r,o,n)=>{let a=rr(n[o]),l=rr(n[o]).datum(),i=a.attr("class");l.mapLevel[t].textLockedAt={opacity:Ze[i]}})}function po(e,t,r,o,n,a,l,i,c){if(o.treemapLevel>0){let s=l.crossValue;ar(l,e,t,r,o,n,a,l,0,s,i,c,1,!1),o.treemapRoute.slice(1,o.treemapRoute.length).forEach(m=>{let d=t.filter(p=>p.crossValue===m).datum(),u=d.crossValue;nr(d,u,t,d.depth,l,n),ar(d,e,t,r,o,n,a,l,d.depth,u,i,c,1,!1)})}}function lr(e,t,r,o,n,a,l,i,c,s){if(!e.children)return;n.treemapLevel<e.depth?n.treemapRoute.push(e.crossValue):n.treemapRoute.pop(),n.treemapLevel=e.depth;let m=e.crossValue;(!e.mapLevel[n.treemapLevel]||!e.mapLevel[n.treemapLevel].levelRoot)&&nr(e,m,r,n.treemapLevel,i,a),ar(e,t,r,o,n,a,l,i,n.treemapLevel,m,c,s)}function ar(e,t,r,o,n,a,l,i,c,s,m,d,u=500,p=!0){let f=e.parent,h=l.transition("main transition").duration(u).ease(Q.easeCubicOut);r.each(y=>y.target=y.mapLevel[c]),Lt(e)||el(r,m),r.transition(h).tween("data",y=>{let x=Q.interpolate(y.current,y.target);return v=>y.current=x(v)}).styleTween("opacity",y=>()=>y.current.opacity).attrTween("pointer-events",y=>()=>y.target.visible?"all":"none"),t.transition(h).filter(y=>y.target.visible).styleTween("x",y=>()=>`${y.current.x0}px`).styleTween("y",y=>()=>`${y.current.y0}px`).styleTween("width",y=>()=>`${y.current.x1-y.current.x0}px`).styleTween("height",y=>()=>`${y.current.y1-y.current.y0}px`),o.transition(h).filter(y=>y.target.visible).attrTween("x",y=>()=>y.current.x0+ze(y.current)/2).attrTween("y",y=>()=>y.current.y0+Ee(y.current)/2).end().catch(()=>or(r)).then(()=>{Lt(e)||(tr(g),Et(g),Za(o,l,u),p&&Ot(r,c),or(r,m,f))}).catch(y=>{console.error("Exception completing promises after main transition",y),or(r,m,f)}),Lt(e)?lo(r):(o.each((y,x,v)=>io(v[x])),zt(r,c,s));let g=Je(r);f?m.hide(!1).text(e.label).onClick(()=>{lr(f,t,r,o,n,a,l,i,m,d);let y=a.node().getRootNode().host.parentElement;Ue(y,f,d)})():m.hide(!0)()}async function Za(e,t,r=400){let o=t.transition("text fade transition").duration(r).ease(Q.easeCubicOut);await e.transition(o).filter(n=>n.target.visible).tween("data",(n,a,l)=>{let i=l[a],c=Q.interpolate(Ja(n),Qa(i));return s=>n.current.opacity=c(s)}).styleTween("opacity",n=>()=>n.current.opacity).end().catch(n=>console.error("Exception in text fade transition",n)).then(()=>e.each((n,a,l)=>so(l[a])))}var Ja=e=>e.target.textLockedAt.opacity,Qa=e=>Ze[Q.select(e).attr("class")],el=(e,t)=>{t.deactivate(!0),e.each((r,o,n)=>{Q.select(n[o]).selectAll("rect").style("pointer-events","none")})},or=(e,t)=>{t&&t.deactivate(!1),e.each((r,o,n)=>{Q.select(n[o]).selectAll("rect").style("pointer-events",null)})};var fo=`<button id="goto-parent">Goto parent</button>
`;function ho(e){let t=null,r=null,o=!0,n=!1,a=N(e,".parent-controls",()=>e.append("div").attr("class","parent-controls").style("display",o?"none":"").html(fo)),l=()=>{a.style("display",o?"none":"").select("#goto-parent").style("pointer-events",n?"none":null).html(`\u21EA ${r}`).on("click",()=>t())};return l.deactivate=(...i)=>{if(!i.length)return n;n=i[0];let c=a.select("#goto-parent");return n?c.style("pointer-events","none"):c.style("pointer-events",null),l},l.hide=(...i)=>i.length?(o=i[0],l):o,l.text=(...i)=>i.length?(r=i[0],l):r,l.onClick=(...i)=>i.length?(t=i[0],l):t,l}var Dt={leaf:"leafnode",branch:"branchnode",root:"rootnode"},ze=e=>e.x1-e.x0,Ee=e=>e.y1-e.y0,rl=(e,t)=>t.depth===e,go=(e,t)=>t.depth===0?Dt.root:rl(e,t)?Dt.leaf:Dt.branch;function yo(){let e=null,t=null,r=null,o=null,n=null,a=null,l=i=>{a=ho(n),a();let c=r.height;e.treemapLevel||(e.treemapLevel=0),e.treemapRoute||(e.treemapRoute=[]),Nt(n.node().getBoundingClientRect().width,n.node().getBoundingClientRect().height)(r);let m=i.selectAll("g").data(r.descendants()),d=m.enter().append("g");d.append("rect"),d.append("text");let u=d.merge(m).sort((g,y)=>y.depth-g.depth),p=u.select("rect").attr("class",g=>`treerect ${go(c,g)}`).style("x",g=>g.x0).style("y",g=>g.y0).style("width",g=>ze(g)).style("height",g=>Ee(g));p.style("fill",g=>go(c,g)===Dt.leaf?g.data.color?o(g.data.color):t.colorStyles.series:"transparent");let f=u.filter(g=>g.value!==0).select("text").attr("x",g=>g.x0+ze(g)/2).attr("y",g=>g.y0+Ee(g)/2).text(g=>g.label),h=p.filter(g=>g.crossValue.length===0).datum();uo(u,h),zt(u,0,[]),Et(Je(u)),Ot(u,0),e.treemapRoute.length===0&&e.treemapRoute.push(h.crossValue),p.filter(g=>g.children).on("click",(g,y)=>lr(y,p,u,f,e,n,i,h,a,t)),po(p,u,f,e,n,i,h,a,t)};return l.settings=(...i)=>i.length?(e=i[0],t=i[1],l):e,l.data=(...i)=>i.length?(r=i[0],l):r,l.color=(...i)=>i.length?(o=i[0],l):o,l.container=(...i)=>i.length?(n=i[0],l):n,l}function xo(e,t){t.treemaps||(t.treemaps={});let r=Ct(t),o=no(t,r.map(c=>c.data));o&&this._container.classList.add("has-legend");let n=Tt().elementsPrefix("treemap");if(e.datum(r).call(n),o){let c=t.realValues[1];if(t.mainValues.find(s=>s.name===c)?.type==="string"){let s=H().settings(t).scale(o);e.call(s)}else{let s=_e().scale(o);e.call(s)}}let a=n.chartEnter(),l=n.chartDiv();n.chartTitle().each((c,s,m)=>Qe.select(m[s]).text(c.split)),a.merge(l).select("svg").select("g.treemap").each(function({split:c,data:s}){let m=Qe.select(this);t.treemaps[c]||(t.treemaps[c]={}),yo().settings(t.treemaps[c],t).data(s).container(Qe.select(Qe.select(this.parentNode).node().parentNode)).color(o)(m),de().settings(t).centered(!0)(m.selectAll("g"))})}xo.plugin={type:"Treemap",name:"Treemap",category:"Hierarchial Chart",max_cells:3e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var bo=xo;var nl=[en,mn,gn,wn,An,Mn,Rn,Yn,Kn,bo,ro,Hn],ir=nl;import*as sr from"d3";import*as vo from"gradient-parser";var wo=(e,t)=>{if(!t.colorStyles){let r={scheme:[],gradient:{},interpolator:{},grid:{}},o=ll(e);r.series=o("--d3fc-local-series");for(let a=1;;a++){let l=`series-${a}`,i=o(`--d3fc-local-${l}`);if(!i)break;r[l]=i,r.scheme.push(i)}r.opacity=ol(r.series),r.grid.gridLineColor=o`--d3fc-gridline--color`,["full","positive","negative"].forEach(a=>{let l=o(`--d3fc-local-${a}--gradient`);r.gradient[a]=il(l,r.opacity)}),t.colorStyles=r}if(!t.textStyles){let r=window.getComputedStyle(e),o=r.getPropertyValue("color"),n=`12px ${r.getPropertyValue("font-family")}`;t.textStyles={color:o,font:n}}},ol=e=>sr.color(e).opacity,al=(e,t)=>{let r=sr.color(`#${e}`);return r.opacity=t,r+""},ll=e=>{let t=getComputedStyle(e);return r=>t?.getPropertyValue(r)},il=(e,t)=>{let r=vo.parse(e)[0].colorStops;return r.map((o,n)=>[o.length?o.length.value/100:n/(r.length-1),al(o.value,t)]).sort((o,n)=>o[0]-n[0])};var _o=':host .chart{--d3fc-local-full--gradient:var(--d3fc-full--gradient,linear-gradient(#4d342f 0%,#e4521b 22.5%,#feeb65 42.5%,#f0f0f0 50%,#dcedc8 57.5%,#42b3d5 67.5%,#1a237e 100%));--d3fc-local-positive--gradient:var(--d3fc-positive--gradient,linear-gradient(#dcedc8 0%,#42b3d5 35%,#1a237e 100%));--d3fc-local-negative--gradient:var(--d3fc-negative--gradient,linear-gradient(#feeb65 100%,#e4521b 70%,#4d342f 0%));--d3fc-local-series:var(--d3fc-series,rgba(31,119,180,0.5));--d3fc-local-series-1:var(--d3fc-series-1,#0366d6);--d3fc-local-series-2:var(--d3fc-series-2,#ff7f0e);--d3fc-local-series-3:var(--d3fc-series-3,#2ca02c);--d3fc-local-series-4:var(--d3fc-series-4,#d62728);--d3fc-local-series-5:var(--d3fc-series-5,#9467bd);--d3fc-local-series-6:var(--d3fc-series-6,#8c564b);--d3fc-local-series-7:var(--d3fc-series-7,#e377c2);--d3fc-local-series-8:var(--d3fc-series-8,#7f7f7f);--d3fc-local-series-9:var(--d3fc-series-9,#bcbd22);--d3fc-local-series-10:var(--d3fc-series-10,#17becf);}:host .chart .series{fill:var(--d3fc-local-series);}:host .chart .series-1{fill:var(--d3fc-local-series-1);}:host .chart .series-2{fill:var(--d3fc-local-series-2);}:host .chart .series-3{fill:var(--d3fc-local-series-3);}:host .chart .series-4{fill:var(--d3fc-local-series-4);}:host .chart .series-5{fill:var(--d3fc-local-series-5);}:host .chart .series-6{fill:var(--d3fc-local-series-6);}:host .chart .series-7{fill:var(--d3fc-local-series-7);}:host .chart .series-8{fill:var(--d3fc-local-series-8);}:host .chart .series-9{fill:var(--d3fc-local-series-9);}:host .chart .series-10{fill:var(--d3fc-local-series-10);}:host{user-select:none;}:host .chart{position:absolute;box-sizing:border-box;left:0;top:0;width:100%;height:100%;padding:12px;overflow:hidden;}:host .chart.heatmap d3fc-group.cartesian-chart,:host .chart.treemap d3fc-group.cartesian-chart{grid-template-columns:minmax(0em,max-content)auto 1fr auto minmax(0em,max-content);grid-template-rows:minmax(0em,max-content)auto 1fr auto minmax(0em,max-content);}:host .chart .chart-label{display:none;}:host .chart.heatmap{padding-right:120px;}:host .chart.sunburst{padding:0;font-size:14px;}:host .chart.sunburst .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto;}:host .chart.sunburst .inner-container div{overflow:hidden;}:host .chart.sunburst .inner-container .sunburst-container:not(:only-child) svg{transform:translate(0,-27px);}:host .chart.sunburst .inner-container svg{width:100%;height:100%;}:host .chart.sunburst .inner-container path{fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host .chart.sunburst .inner-container text.segment,:host .chart.sunburst .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.sunburst .inner-container div.title-container{margin-top:5px;}:host .chart.has-legend{padding-right:120px;}:host .chart.treemap .treemap-container{position:relative;}:host .chart.treemap .treemap-container:not(:only-child){width:calc(100% - 12px);height:calc(100% - 12px);}:host .chart.treemap .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto;}:host .chart.treemap .inner-container div{overflow:hidden;}:host .chart.treemap .inner-container svg{width:100%;height:100%;}:host .chart.treemap .inner-container .treerect{stroke:var(--d3fc-treedata-axis--lines,var(--d3fc-axis--lines,white));fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host .chart.treemap .inner-container .treerect:hover{cursor:pointer;stroke:var(--d3fc-treedata--hover-highlight,black);stroke-opacity:1;}:host .chart.treemap .inner-container .rootnode{opacity:0;pointer-events:none;z-index:0;}:host .chart.treemap .inner-container .branchnode{opacity:0;}:host .chart.treemap .inner-container .branchnode:hover{fill-opacity:0.1;opacity:1;fill:var(--d3fc-treedata--hover-highlight,black);}:host .chart.treemap .inner-container .leafnode{fill-opacity:0.8;}:host .chart.treemap .inner-container .leafnode:hover{fill-opacity:0.5;}:host .chart.treemap .inner-container #hidden{opacity:0;pointer-events:none;z-index:0;}:host .chart.treemap .inner-container .top{font-size:14px;z-index:5;pointer-events:none;}:host .chart.treemap .inner-container .mid{font-size:8px;opacity:0.7;z-index:4;}:host .chart.treemap .inner-container .lower{font-size:0px;opacity:0;z-index:4;}:host .chart.treemap .inner-container text{fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.treemap .inner-container text.title{dominant-baseline:hanging;}:host .chart.treemap .inner-container .parent-controls{position:absolute;top:12px;right:auto;left:30px;width:auto;z-index:4;transition:box-shadow 1s;}:host .chart.treemap .inner-container .parent-controls:hover{box-shadow:2px 2px 6px#000;transition:box-shadow 0.2s;}:host .chart .x-label{height:1.2em!important;line-height:1em!important;}:host .chart .x-label,:host .chart .y-label{color:var(--d3fc-label--color,inherit);font-size:14px;}:host .chart d3fc-canvas.plot-area{display:none;}:host .chart.xyscatter d3fc-canvas.plot-area,:host .chart.xyline d3fc-canvas.plot-area,:host .chart.ohlc d3fc-canvas.plot-area,:host .chart.candlestick d3fc-canvas.plot-area,:host .chart.heatmap d3fc-canvas.plot-area{display:block;}:host .chart .y-axis text,:host .chart .x-axis text{fill:var(--d3fc-axis-ticks--color,rgb(80,80,80));font-size:11px;}:host .chart .y-axis path,:host .chart .x-axis path{stroke:var(--d3fc-axis--lines,rgb(180,210,225));}:host .chart .splitter-label{display:inline-block;margin:0 10px;cursor:pointer;}:host .chart .splitter-label::after{margin-left:5px;color:var(--d3fc-axis--lines,rgb(180,210,225));}:host .chart .splitter-label:hover::after{color:var(--d3fc-axis-ticks--color,rgb(80,80,80));}:host .chart .splitter-label.disabled::after{color:rgba(80,80,80,0.3);}:host .chart .splitter-label.disabled{cursor:default;}:host .chart .y-label.left-label .splitter-label::after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:16px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}:host .chart .y-label.right-label .splitter-label::after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:16px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}:host .chart.ybar .y-axis path,:host .chart.yline .y-axis path,:host .chart.xyline .y-axis path,:host .chart.xyline .x-axis path,:host .chart.yarea .y-axis path,:host .chart.yscatter .y-axis path,:host .chart.xyscatter .y-axis path,:host .chart.xyscatter .x-axis path,:host .chart.xbar .x-axis path{visibility:hidden;}:host .chart .y-label{white-space:nowrap;}:host .chart .nearbyTip{fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host #dragHandles{position:absolute;top:0px;right:0px;left:auto;pointer-events:none;}:host #dragHandles rect{pointer-events:all;}:host .label rect{fill:none;}:host .legend-container{position:absolute;top:12px;right:12px;left:auto;width:150px;height:280px;}:host .legend-container.legend-color{width:90px;height:150px;}:host .legend-container[borderbox-on-hover="true"]{transition:box-shadow 1s;}:host .legend-container[borderbox-on-hover="true"]:hover{background-color:var(--d3fc-legend--background,#ffffff);transition:box-shadow 0.2s,background-color 0.2s;}:host .legend-container .legend{font-size:8pt;width:100%;}:host .legend-container .legend .cell{cursor:pointer;}:host .legend-container .legend .cell path{fill:var(--d3fc-series,rgba(31,119,180,0.5));stroke:var(--d3fc-series,rgb(31,119,180));}:host .legend-container .legend .cell.hidden path{fill:rgba(204,204,204,0.5);stroke:rgb(204,204,204);}:host .legend-container .legend .cell.hidden circle{fill:rgb(204,204,204)!important;}:host .legend-container text{fill:var(--d3fc-legend--text,rgb(51,51,51));}:host .legend-container .label:hover{fill:rgb(34,160,206);}:host .legend-container #legend-axis path{stroke:var(--d3fc-legend--text,rgb(51,51,51));}:host .legend-container .legend-controls{margin-left:12px;}:host .legend-container .legend-controls #up-arrow,:host .legend-container .legend-controls #down-arrow{cursor:pointer;color:rgb(31,119,180);}:host .legend-container .legend-controls #up-arrow.disabled,:host .legend-container .legend-controls #down-arrow.disabled{cursor:default;color:rgb(51,51,51);}:host .heatmap .legend-container.legend-color{height:200px;}:host .treemap .legend-container.legend-color{height:200px;}:host .treemap .legend-container:not(.legend-color){width:100px;}:host .zoom-controls{position:absolute;top:10px;left:0;width:100%;text-align:center;}:host .zoom-controls button{-webkit-appearance:none;background:var(--plugin--background,rgb(247,247,247));border:1px solid var(--inactive--color,rgb(204,204,204));color:var(--d3fc-label--color,inherit);font-size:12px;padding:8px;opacity:0.5;cursor:pointer;}:host .zoom-controls button:hover{opacity:1;}:host .parent-controls{position:absolute;top:30px;right:145px;width:100%;text-align:right;}:host .parent-controls button{-webkit-appearance:none;background:rgb(247,247,247);border:1px solid rgb(204,204,204);padding:10px;opacity:0.5;cursor:pointer;}:host .parent-controls button:hover{background:rgb(230,230,230);}:host div.tooltip{position:absolute;text-align:left;font-size:12px;font-weight:300;white-space:nowrap;padding:0.5em;background:var(--d3fc-tooltip--background,#ffffff);color:var(--d3fc-tooltip--color,black);border:1px solid var(--d3fc-tooltip--border-color,#777777);box-shadow:var(--d3fc-tooltip--box-shadow,none);pointer-events:none;}:host div.tooltip ul{margin:0;padding:0;list-style-type:none;}';import*as So from"d3";var Vo={initial:{type:"number",count:1},selectMode:"select"},cl=`${_o}${ul()}`,cr=["crossValues","mainValues","realValues","splitValues","filter","data","size","colorStyles","textStyles","agg_paths","treemaps","axisMemo"];function ul(){let e=document.querySelector("head").querySelectorAll("style"),t=[];return e.forEach(r=>{r.innerText.indexOf("d3fc-")!==-1&&t.push(r.innerText)}),t.join("")}function ml(e){customElements.get("perspective-viewer").registerPlugin(e)}function Co(...e){e=new Set(e.length>0?e:ir.map(t=>t.plugin.name)),ir.forEach(t=>{if(e.has(t.plugin.name)){let r=t.plugin.name.toLowerCase().replace(/[ \t\r\n\/]*/g,""),o=`perspective-viewer-d3fc-${r}`;customElements.define(o,class extends HTMLElement{constructor(){super(),this._chart=null,this._settings=null,this.render_warning=!0}connectedCallback(){this._initialized||(this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`<style>${cl}</style>`,this.shadowRoot.innerHTML+='<div id="container" class="chart"></div>',this._container=this.shadowRoot.querySelector(".chart"),this._initialized=!0)}get name(){return t.plugin.name}get category(){return t.plugin.category}get select_mode(){return t.plugin.selectMode||"select"}get min_config_columns(){return t.plugin.initial?.count||Vo.initial.count}get config_column_names(){return t.plugin.initial?.names||Vo.initial.names}get max_cells(){return t.plugin.max_cells||4e3}set max_cells(n){t.plugin.max_cells=n}get max_columns(){return t.plugin.max_columns||50}set max_columns(n){t.plugin.max_columns=n}async render(){var n=document.createElement("canvas"),a=this.shadowRoot.querySelector("#container");n.width=a.offsetWidth,n.height=a.offsetHeight;let l=n.getContext("2d");l.fillStyle=window.getComputedStyle(this).getPropertyValue("--plugin--background")||"white",l.fillRect(0,0,n.width,n.height);let i=window.getComputedStyle(this).getPropertyValue("color"),c=Array.from(this.shadowRoot.querySelectorAll("svg:not(#dragHandles)"));for(let u of c.reverse()){var s=document.createElement("img");s.width=u.parentNode.offsetWidth,s.height=u.parentNode.offsetHeight;let p=u.cloneNode(!0);p.hasAttribute("viewBox")||p.setAttribute("viewBox",`0 0 ${s.width} ${s.height}`),p.setAttribute("xmlns","http://www.w3.org/2000/svg");for(let h of p.querySelectorAll("text"))h.setAttribute("fill",i);var m=new XMLSerializer().serializeToString(p);m=m.replace(/[^\x00-\x7F]/g,"");let f=new Promise((h,g)=>{s.onload=h,s.onerror=g});try{s.src=`data:image/svg+xml;base64,${btoa(m)}`,await f}catch{let g=new Promise((y,x)=>{s.onload=y,s.onerror=x});s.src=`data:image/svg+xml;utf8,${m}`,await g}l.drawImage(s,u.parentNode.offsetLeft,u.parentNode.offsetTop,s.width,s.height)}let d=Array.from(this.shadowRoot.querySelectorAll("canvas"));for(let u of d.reverse())l.drawImage(u,u.parentNode.offsetLeft,u.parentNode.offsetTop,u.width/window.devicePixelRatio,u.height/window.devicePixelRatio);return await new Promise(u=>n.toBlob(p=>u(p)),"image/png")}async draw(n,a,l){if(this.offsetParent===null){this._staged_view=[n,a,l];return}this._staged_view=void 0,this._settings&&(this._settings.axisMemo=[[1/0,-1/0],[1/0,-1/0]]),await this.update(n,a,l,!0)}async update(n,a,l,i=!1){if(this.offsetParent===null)return;let c=this.parentElement,s,m,d=t.plugin.name!=="Sunburst";a&&l?s=n.to_json({end_row:l,end_col:a,leaves_only:d}):a?s=n.to_json({end_col:a,leaves_only:d}):l?s=n.to_json({end_row:l,leaves_only:d}):s=n.to_json({leaves_only:d}),m=await Promise.all([c.save(),c.getTable().then(S=>S.schema(!1)),n.expression_schema(!1),n.schema(!1),s,n.get_config()]);let[u,p,f,h,g,y]=m;this.config=u;let x=this.config.columns,v=function(S){let T=p[S];return T||(T=f[S]),T},{columns:b,group_by:w,split_by:V,filter:k}=y,B=w.length>0?g.reduce((S,T)=>{if(T.__ROW_PATH__&&T.__ROW_PATH__.length==w.length)S.agg_paths.push(S.aggs.slice()),S.rows.push(T);else{let $=T.__ROW_PATH__.filter(ee=>ee!==void 0).length;S.aggs[$]=T,S.aggs=S.aggs.slice(0,$+1)}return S},{rows:[],aggs:[],agg_paths:[]}):{rows:g},j=(S,T)=>w.length?S:{...S,__ROW_PATH__:[T]},M=B.rows.map(j),z={realValues:x,crossValues:w.map(S=>({name:S,type:v(S)})),mainValues:b.map(S=>({name:S,type:h[S]})),splitValues:V.map(S=>({name:S,type:v(S)})),filter:k,data:M,agg_paths:B.agg_paths};this._chart=t;let I={set:(S,T,$)=>(cr.includes(T)||this._container&&this._container.dispatchEvent(new Event("perspective-plugin-update",{bubbles:!0,composed:!0})),S[T]=$,!0)},E=[[1/0,-1/0],[1/0,-1/0]];this._settings=new Proxy({axisMemo:E,...this._settings,...z},I),this._settings.splitMainValues&&this._settings.splitMainValues.length>=b.length&&(this._settings.splitMainValues=[]),wo(this._container,this._settings),i&&(this._container.innerHTML=""),this._draw(),await new Promise(S=>requestAnimationFrame(S))}async clear(){this._container&&(this._container.innerHTML="")}_draw(){if(this.offsetParent!==null){let n=So.select(this._container),a=`chart ${r}`;this._settings.size=this._container.getBoundingClientRect(),this._settings.data.length>0?this._chart(n.attr("class",a),this._settings):n.attr("class",`${a} disabled`)}}async resize(n){if(this.offsetParent!==null)if(this._settings?.data!==void 0)this._draw();else{let[a,l,i]=this._staged_view;this._staged_view=void 0,this.draw(a,l,i)}}async restyle(...n){let a=this._settings;a&&(delete a.colorStyles,delete a.textStyles,await this.draw(...n))}async delete(){this._container.innerHTML=""}getContainer(){return this._container}save(){let n={...this._settings};return cr.forEach(a=>{delete n[a]}),n}restore(n){let a={};for(let l of cr)this._settings?.[l]!==void 0&&(a[l]=this._settings?.[l]);this._settings={...a,...n}}}),customElements.whenDefined("perspective-viewer").then(()=>ml(o))}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector);Co("OHLC");
//# sourceMappingURL=ohlc.js.map
